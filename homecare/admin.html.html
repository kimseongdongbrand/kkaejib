<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘ - ê´€ë¦¬ì</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f7fa; padding: 20px; }
        .header { background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .action-btn { padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stat-number { font-size: 36px; font-weight: 800; }
        .stat-label { font-size: 13px; color: #666; font-weight: 600; margin-top: 5px; }
        .section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .section-header h2 { color: #2c3e50; font-size: 20px; }
        .manager-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .manager-card { background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #00AEEF; cursor: pointer; position: relative; transition: all 0.3s; }
        .manager-card:hover { background: #e8f4f8; transform: scale(1.02); }
        .manager-name { font-size: 20px; font-weight: 800; color: #2c3e50; margin-bottom: 8px; padding-right: 40px; }
        .manager-remove-btn { position: absolute; top: 10px; right: 10px; width: 28px; height: 28px; border: none; background: #e74c3c; color: white; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 999; line-height: 26px; font-weight: bold; }
        .manager-remove-btn:hover { background: #c0392b; transform: scale(1.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin: 5px; font-size: 13px; color: white; }
        .btn-primary { background: #00AEEF; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-warning { background: #f39c12; }
        .btn-info { background: #3498db; }
        .filter-btn { padding: 10px 20px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; }
        .filter-btn.active { background: #00AEEF; color: white; border-color: #00AEEF; }
        .booking-card { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 12px; border-left: 5px solid #e0e0e0; }
        .customer-name { font-size: 22px; font-weight: 800; color: #2c3e50; margin-bottom: 12px; }
        .info-item { margin: 8px 0; font-size: 14px; }
        .booking-actions { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; align-items: center; }
        .booking-actions select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .status-badge { display: inline-block; padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 700; margin: 8px 8px 8px 0; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 25px; }
        .modal-buttons button { flex: 1; padding: 14px; }
        
        .confirm-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; }
        .confirm-modal.show { display: flex; }
        .confirm-content { background: white; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: center; }
        .confirm-content h3 { font-size: 20px; margin-bottom: 20px; color: #2c3e50; }
        .confirm-buttons { display: flex; gap: 10px; margin-top: 25px; }
        .confirm-buttons button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; cursor: pointer; }
        
        .calendar-modal-large { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1500; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .calendar-modal-large.show { display: flex; }
        .calendar-big-container { background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .calendar-big-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .calendar-big-nav-btn { padding: 10px 20px; border: none; background: #00AEEF; color: white; font-size: 18px; border-radius: 10px; cursor: pointer; font-weight: 700; }
        .calendar-big-title { font-size: 28px; font-weight: 700; color: #2c3e50; }
        .calendar-big-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 15px; }
        .calendar-big-weekday { text-align: center; font-weight: 700; color: #666; padding: 15px 0; font-size: 16px; background: #f8f9fa; border-radius: 8px; }
        .calendar-big-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .calendar-big-day { min-height: 100px; border: 2px solid #e0e0e0; background: white; border-radius: 12px; padding: 10px; cursor: pointer; transition: all 0.3s; position: relative; }
        .calendar-big-day:hover { border-color: #00AEEF; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,174,239,0.2); }
        .calendar-big-day-number { font-size: 20px; font-weight: 700; color: #2c3e50; margin-bottom: 8px; }
        .calendar-big-day.has-bookings { background: #e8f4f8; border-color: #00AEEF; }
        .calendar-booking-count { background: #00AEEF; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 700; display: inline-block; }
        .calendar-big-day.empty { border: none; cursor: default; background: transparent; }
        .calendar-close-btn { margin-top: 20px; width: 100%; padding: 15px; background: #95a5a6; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; }
        
        .finance-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; table-layout: auto; }
        .finance-table th, .finance-table td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #e0e0e0; white-space: nowrap; }
        .finance-table th { background: #f8f9fa; font-weight: 700; color: #2c3e50; font-size: 12px; }
        .finance-table th:nth-child(1) { min-width: 100px; } /* ë‚ ì§œ */
        .finance-table th:nth-child(2) { min-width: 200px; } /* ì´ë¦„/ì „í™”/ì£¼ì†Œ */
        .finance-table th:nth-child(3) { min-width: 60px; } /* í‰í˜• */
        .finance-table th:nth-child(4) { min-width: 150px; } /* ì„œë¹„ìŠ¤ */
        .finance-table th:nth-child(5) { min-width: 80px; } /* ê´€ë¦¬ì */
        .finance-table th:nth-child(6) { min-width: 80px; } /* ìƒíƒœ */
        .finance-table th:nth-child(7) { min-width: 100px; } /* ë§¤ì¶œ */
        .finance-table th:nth-child(8) { min-width: 100px; } /* ë§¤ë‹ˆì € ë¹„ìš© */
        .finance-table th:nth-child(9) { min-width: 100px; } /* ìˆœì´ìµ */
        .finance-table td:nth-child(2) { white-space: normal; } /* ì´ë¦„/ì „í™”/ì£¼ì†ŒëŠ” ì¤„ë°”ê¿ˆ í—ˆìš© */
        .finance-table td:nth-child(4) { white-space: normal; } /* ì„œë¹„ìŠ¤ëª…ë„ ì¤„ë°”ê¿ˆ í—ˆìš© */
        .finance-table tr:hover { background: #f8f9fa; }
        .profit-positive { color: #27ae60; font-weight: 700; }
        .profit-negative { color: #e74c3c; font-weight: 700; }
        
        .day-bookings-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2500; align-items: center; justify-content: center; padding: 20px; }
        .day-bookings-modal.show { display: flex; }
        .day-bookings-content { background: white; border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        
        /* í¸ì§‘ ê°€ëŠ¥í•œ ì…€ ìŠ¤íƒ€ì¼ */
        .editable { 
            cursor: pointer; 
            padding: 4px 8px; 
            border-radius: 4px; 
            transition: all 0.2s;
            border: 1px dashed transparent;
        }
        .editable:hover { 
            background: #fff3cd; 
            border-color: #f39c12;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ  (ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘ - ê´€ë¦¬ì</h1>
        <p>ì»¨íŠ¸ë¡¤íƒ€ì›Œ</p>
        <div>
            <button class="action-btn" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <button class="action-btn" onclick="exportExcel()">ğŸ“Š ì—‘ì…€</button>
            <button class="action-btn" onclick="showBigCalendar()">ğŸ“… ìº˜ë¦°ë”</button>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card"><div class="stat-number" id="totalCount">0</div><div class="stat-label">ì „ì²´ ì˜ˆì•½</div></div>
        <div class="stat-card"><div class="stat-number" id="receivedCount">0</div><div class="stat-label">ì‹ ê·œì˜ˆì•½</div></div>
        <div class="stat-card"><div class="stat-number" id="confirmedCount">0</div><div class="stat-label">ì˜ˆì•½í™•ì •</div></div>
        <div class="stat-card"><div class="stat-number" id="startedCount">0</div><div class="stat-label">ì‘ì—…ì‹œì‘</div></div>
        <div class="stat-card"><div class="stat-number" id="completedCount">0</div><div class="stat-label">ì‘ì—…ì™„ë£Œ</div></div>
        <div class="stat-card"><div class="stat-number" id="paidCount">0</div><div class="stat-label">ì…ê¸ˆì™„ë£Œ</div></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ‘¥ ê´€ë¦¬ì ê´€ë¦¬</h2>
            <div>
                <button class="btn btn-primary" onclick="toggleMgr()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
                <button class="btn btn-success" onclick="showAddModal()">+ ê´€ë¦¬ì ì¶”ê°€</button>
            </div>
        </div>
        <div class="manager-list" id="managerList" style="display: none;"></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ†• ì‹ ê·œì˜ˆì•½</h2>
            <button class="btn btn-primary" onclick="toggleNew()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="newBookingList" style="display: none;"></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ“‹ ì˜ˆì•½ ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="toggleBook()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="bookingSection">
            <div style="margin-bottom: 20px;">
                <button class="filter-btn active" onclick="setFilter('all')">ì „ì²´</button>
                <button class="filter-btn" onclick="setFilter('received')">ì˜ˆì•½ì ‘ìˆ˜</button>
                <button class="filter-btn" onclick="setFilter('confirmed')">ì˜ˆì•½í™•ì •</button>
                <button class="filter-btn" onclick="setFilter('started')">ì‘ì—…ì‹œì‘</button>
                <button class="filter-btn" onclick="setFilter('completed')">ì‘ì—…ì™„ë£Œ</button>
                <button class="filter-btn" onclick="setFilter('paid')">ì…ê¸ˆì™„ë£Œ</button>
            </div>
            <div id="bookingList"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ’° ì¬ì •ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="toggleFinance()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="financeSection" style="display: block;">
            <div style="overflow-x: auto;">
                <table class="finance-table" id="financeTable">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì ‘ìˆ˜ë‚ ì§œ</th>
                            <th>ì„œë¹„ìŠ¤ë‚ ì§œ</th>
                            <th>ì´ë¦„<br><small>ì „í™”/ì£¼ì†Œ</small></th>
                            <th>í‰í˜•</th>
                            <th>ì„œë¹„ìŠ¤</th>
                            <th>ë§¤ë‹ˆì €</th>
                            <th>ì‘ì—…í˜„í™©</th>
                            <th>ì´ë§¤ì¶œ<br><small>(ì›)</small></th>
                            <th>ë§¤ë‹ˆì €í˜ì´<br><small>(ì›)</small></th>
                            <th>ìˆœì´ìµ<br><small>(ì›)</small></th>
                            <th>ê²°ì œë°©ë²•</th>
                            <th>ì…ê¸ˆì¼</th>
                            <th>ë¯¸ìˆ˜ê¸ˆ<br><small>(ì›)</small></th>
                            <th>êµ¬ë¶„</th>
                            <th>ìˆ˜ì •</th>
                        </tr>
                    </thead>
                    <tbody id="financeBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal" id="addManagerModal">
        <div class="modal-content">
            <h3>ğŸ‘¤ ê´€ë¦¬ì íšŒì›ê°€ì…</h3>
            <div class="form-group"><label>ì´ë¦„ *</label><input type="text" id="managerName"></div>
            <div class="form-group"><label>ë‚˜ì´ *</label><input type="number" id="managerAge"></div>
            <div class="form-group"><label>ì „í™” *</label><input type="tel" id="managerPhone"></div>
            <div class="form-group"><label>ì£¼ì†Œ *</label><input type="text" id="managerAddress"></div>
            <div class="form-group"><label>ì•„ì´ë”” *</label><input type="text" id="managerId"></div>
            <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ *</label><input type="password" id="managerPassword"></div>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="hideAddModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="addMgr()">íšŒì›ê°€ì…</button>
            </div>
        </div>
    </div>

    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <h3 id="confirmMessage"></h3>
            <div class="confirm-buttons">
                <button onclick="confirmCancel()" style="background: #95a5a6; color: white;">ì·¨ì†Œ</button>
                <button onclick="confirmOk()" style="background: #e74c3c; color: white;">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div class="calendar-modal-large" id="bigCalendarModal">
        <div class="calendar-big-container">
            <div class="calendar-big-header">
                <button class="calendar-big-nav-btn" onclick="prevBigMonth()">â—€ ì´ì „</button>
                <div class="calendar-big-title" id="bigCalendarTitle">2025ë…„ 1ì›”</div>
                <button class="calendar-big-nav-btn" onclick="nextBigMonth()">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-big-weekdays">
                <div class="calendar-big-weekday">ì¼</div>
                <div class="calendar-big-weekday">ì›”</div>
                <div class="calendar-big-weekday">í™”</div>
                <div class="calendar-big-weekday">ìˆ˜</div>
                <div class="calendar-big-weekday">ëª©</div>
                <div class="calendar-big-weekday">ê¸ˆ</div>
                <div class="calendar-big-weekday">í† </div>
            </div>
            <div class="calendar-big-days" id="bigCalendarDays"></div>
            <button class="calendar-close-btn" onclick="hideBigCalendar()">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="calendar-modal-large" id="managerCalendarModal">
        <div class="calendar-big-container">
            <h2 style="margin-bottom: 20px; color: #2c3e50;" id="managerCalendarName"></h2>
            <div class="calendar-big-header">
                <button class="calendar-big-nav-btn" onclick="prevManagerMonth()">â—€ ì´ì „</button>
                <div class="calendar-big-title" id="managerCalendarTitle">2025ë…„ 1ì›”</div>
                <button class="calendar-big-nav-btn" onclick="nextManagerMonth()">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-big-weekdays">
                <div class="calendar-big-weekday">ì¼</div>
                <div class="calendar-big-weekday">ì›”</div>
                <div class="calendar-big-weekday">í™”</div>
                <div class="calendar-big-weekday">ìˆ˜</div>
                <div class="calendar-big-weekday">ëª©</div>
                <div class="calendar-big-weekday">ê¸ˆ</div>
                <div class="calendar-big-weekday">í† </div>
            </div>
            <div class="calendar-big-days" id="managerCalendarDays"></div>
            <button class="calendar-close-btn" onclick="hideManagerCalendar()">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="day-bookings-modal" id="dayBookingsModal">
        <div class="day-bookings-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;" id="dayBookingsTitle"></h2>
            <div id="dayBookingsList"></div>
            <button class="calendar-close-btn" onclick="hideDayBookings()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // âš ï¸ Google Apps Script ë°°í¬ í›„ ì•„ë˜ URLì„ ì‹¤ì œ ì›¹ ì•± URLë¡œ êµì²´í•˜ì„¸ìš”!
        var GOOGLE_SCRIPT_URL = '';
        
        var bookings = [];
        var managers = [];
        var curFilter = 'all';
        var mgrOpen = false;
        var newOpen = false;
        var bookOpen = true;
        var financeOpen = true;
        var confirmCallback = null;
        var bigCalYear = new Date().getFullYear();
        var bigCalMonth = new Date().getMonth();
        var mgrCalYear = new Date().getFullYear();
        var mgrCalMonth = new Date().getMonth();
        var selectedManager = '';

        var priceTable = {
            '30í‰í˜•(20í‰í˜• í¬í•¨)': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 150000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 210000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 280000 },
            '40í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 180000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 250000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 320000 },
            '50í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 210000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 290000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 360000 },
            '60í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 250000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 330000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 400000 }
        };

        var MANAGER_COST = 130000;

        function getPrice(size, service) {
            console.log('getPrice í˜¸ì¶œ - size:', size, '/ service:', service);
            
            // ì¼€ì´ìŠ¤ 1: serviceì—ì„œ ê°€ê²© ì¶”ì¶œ ì‹œë„ (ê°€ì¥ ì¼ë°˜ì ì¸ ê²½ìš°)
            var priceMatch = service.match(/\(([0-9,]+)ì›\)/);
            if (priceMatch) {
                var extractedPrice = parseInt(priceMatch[1].replace(/,/g, ''));
                console.log('  -> serviceì—ì„œ ê°€ê²© ì¶”ì¶œ:', extractedPrice);
                return extractedPrice;
            }
            
            // ì¼€ì´ìŠ¤ 2: sizeì—ì„œ ê°€ê²© ì¶”ì¶œ ì‹œë„ (ì´ì „ ë²„ì „ ë°ì´í„° í˜¸í™˜)
            if (size) {
                priceMatch = size.match(/\(([0-9,]+)ì›\)/);
                if (priceMatch) {
                    var extractedPrice = parseInt(priceMatch[1].replace(/,/g, ''));
                    console.log('  -> sizeì—ì„œ ê°€ê²© ì¶”ì¶œ:', extractedPrice);
                    return extractedPrice;
                }
            }
            
            // ì¼€ì´ìŠ¤ 3: ê°€ê²©í‘œì—ì„œ ê²€ìƒ‰ (sizeì™€ service ëª¨ë‘ ìˆëŠ” ê²½ìš°)
            if (size && service && priceTable[size] && priceTable[size][service]) {
                var price = priceTable[size][service];
                console.log('  -> ê°€ê²©í‘œì—ì„œ ì°¾ìŒ:', price);
                return price;
            }
            
            // ì¼€ì´ìŠ¤ 4: ì„œë¹„ìŠ¤ëª… ì •ê·œí™” í›„ ê°€ê²©í‘œ ì¬ê²€ìƒ‰
            if (size && service) {
                var normalizedService = service
                    .replace('ë°°ê´€', 'ê´€')
                    .replace(/\s*\([^)]*\)/g, '')
                    .trim();
                
                if (priceTable[size] && priceTable[size][normalizedService]) {
                    var price = priceTable[size][normalizedService];
                    console.log('  -> ì •ê·œí™” í›„ ê°€ê²©í‘œì—ì„œ ì°¾ìŒ:', price);
                    return price;
                }
            }
            
            console.log('  -> ê°€ê²©ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ, 0 ë°˜í™˜');
            return 0;
        }

        function extractSize(fullSize, fullService) {
            // fullSizeì—ì„œ í‰í˜• ê²€ìƒ‰
            if (fullSize) {
                var match = fullSize.match(/(\d+)í‰í˜•/);
                if (match) {
                    return match[1] + 'í‰';
                }
            }
            
            // fullSizeê°€ ì—†ìœ¼ë©´ fullServiceì—ì„œ ê²€ìƒ‰
            if (fullService) {
                var match = fullService.match(/(\d+)í‰í˜•/);
                if (match) {
                    return match[1] + 'í‰';
                }
            }
            
            return '-';
        }

        function extractService(fullService) {
            if (!fullService || fullService === '') return '-';
            // ê´„í˜¸ì™€ ê°€ê²© ì œê±°
            var cleaned = fullService.replace(/\s*\([^)]*\)/g, '').trim();
            // ì „ì²´ ì„œë¹„ìŠ¤ëª… ê·¸ëŒ€ë¡œ ë°˜í™˜
            return cleaned;
        }

        function showConfirm(message, callback) {
            console.log('ğŸ“¢ Confirm ëª¨ë‹¬ í‘œì‹œ:', message);
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('show');
            confirmCallback = callback;
        }

        function confirmOk() {
            console.log('âœ… í™•ì¸ ë²„íŠ¼ í´ë¦­');
            document.getElementById('confirmModal').classList.remove('show');
            if (confirmCallback) confirmCallback(true);
            confirmCallback = null;
        }

        function confirmCancel() {
            console.log('âŒ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­');
            document.getElementById('confirmModal').classList.remove('show');
            if (confirmCallback) confirmCallback(false);
            confirmCallback = null;
        }

        function loadMgrs() {
            console.log('ê´€ë¦¬ì ë¡œë“œ');
            var data = localStorage.getItem('managers');
            managers = data ? JSON.parse(data) : [];
            renderMgrs();
        }

        function renderMgrs() {
            var div = document.getElementById('managerList');
            if (managers.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ë“±ë¡ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            div.innerHTML = '';
            for (var i = 0; i < managers.length; i++) {
                var card = document.createElement('div');
                card.className = 'manager-card';
                
                var btn = document.createElement('button');
                btn.className = 'manager-remove-btn';
                btn.textContent = 'Ã—';
                btn.style.right = '50px';
                btn.onclick = (function(name) {
                    return function(e) {
                        e.stopPropagation();
                        console.log('ğŸ”´ ì‚­ì œ ë²„íŠ¼ í´ë¦­:', name);
                        deleteManager(name);
                    };
                })(managers[i]);
                
                var editBtn = document.createElement('button');
                editBtn.className = 'manager-remove-btn';
                editBtn.textContent = 'âœ';
                editBtn.style.background = '#3498db';
                editBtn.style.right = '10px';
                editBtn.onclick = (function(name) {
                    return function(e) {
                        e.stopPropagation();
                        console.log('âœï¸ ìˆ˜ì • ë²„íŠ¼ í´ë¦­:', name);
                        editManager(name);
                    };
                })(managers[i]);
                
                var nameDiv = document.createElement('div');
                nameDiv.className = 'manager-name';
                nameDiv.textContent = 'ğŸ‘¤ ' + managers[i];
                
                var infoDiv = document.createElement('div');
                infoDiv.style.fontSize = '13px';
                infoDiv.style.color = '#666';
                infoDiv.textContent = 'ìŠ¤ì¼€ì¤„ ê´€ë¦¬ (í´ë¦­í•˜ì—¬ ìº˜ë¦°ë” ë³´ê¸°)';
                
                card.onclick = (function(name) {
                    return function() {
                        console.log('ğŸ“… ê´€ë¦¬ì ìº˜ë¦°ë” ì—´ê¸°:', name);
                        showManagerCalendar(name);
                    };
                })(managers[i]);
                
                card.appendChild(btn);
                card.appendChild(editBtn);
                card.appendChild(nameDiv);
                card.appendChild(infoDiv);
                div.appendChild(card);
            }
            
            console.log('ê´€ë¦¬ì ë Œë”ë§ ì™„ë£Œ:', managers.length);
        }

        function showManagerCalendar(name) {
            selectedManager = name;
            document.getElementById('managerCalendarName').textContent = 'ğŸ‘¤ ' + name + 'ë‹˜ì˜ ì¼ì •';
            document.getElementById('managerCalendarModal').classList.add('show');
            mgrCalYear = new Date().getFullYear();
            mgrCalMonth = new Date().getMonth();
            renderManagerCalendar();
        }

        function hideManagerCalendar() {
            document.getElementById('managerCalendarModal').classList.remove('show');
        }

        function prevManagerMonth() {
            mgrCalMonth--;
            if (mgrCalMonth < 0) {
                mgrCalMonth = 11;
                mgrCalYear--;
            }
            renderManagerCalendar();
        }

        function nextManagerMonth() {
            mgrCalMonth++;
            if (mgrCalMonth > 11) {
                mgrCalMonth = 0;
                mgrCalYear++;
            }
            renderManagerCalendar();
        }

        function renderManagerCalendar() {
            var monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('managerCalendarTitle').textContent = mgrCalYear + 'ë…„ ' + monthNames[mgrCalMonth];

            var firstDay = new Date(mgrCalYear, mgrCalMonth, 1).getDay();
            var daysInMonth = new Date(mgrCalYear, mgrCalMonth + 1, 0).getDate();

            // ë§¤ë‹ˆì € íœ´ë¬´ ì •ë³´ ë¡œë“œ
            var vacationKey = 'vacations_' + selectedManager;
            var vacations = JSON.parse(localStorage.getItem(vacationKey) || '[]');

            var container = document.getElementById('managerCalendarDays');
            container.innerHTML = '';

            for (var i = 0; i < firstDay; i++) {
                var empty = document.createElement('div');
                empty.className = 'calendar-big-day empty';
                container.appendChild(empty);
            }

            for (var day = 1; day <= daysInMonth; day++) {
                var dateStr = mgrCalYear + '-' + String(mgrCalMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                var dayBookings = bookings.filter(function(b) { 
                    return b.serviceDate === dateStr && b.manager === selectedManager; 
                });

                // íœ´ë¬´ì¸ì§€ í™•ì¸
                var isVacation = vacations.some(function(v) { return v.date === dateStr; });

                var dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-big-day';
                
                var numDiv = document.createElement('div');
                numDiv.className = 'calendar-big-day-number';
                numDiv.textContent = day;
                dayDiv.appendChild(numDiv);

                if (isVacation) {
                    dayDiv.style.background = '#ffeaea';
                    dayDiv.style.borderColor = '#e74c3c';
                    var vacDiv = document.createElement('div');
                    vacDiv.style.cssText = 'background: #e74c3c; color: white; padding: 2px 6px; border-radius: 8px; font-size: 10px; font-weight: 700;';
                    vacDiv.textContent = 'íœ´ë¬´';
                    dayDiv.appendChild(vacDiv);
                } else if (dayBookings.length > 0) {
                    dayDiv.classList.add('has-bookings');
                    var countDiv = document.createElement('div');
                    countDiv.className = 'calendar-booking-count';
                    countDiv.textContent = dayBookings.length + 'ê±´';
                    dayDiv.appendChild(countDiv);

                    dayDiv.onclick = (function(date, bks) {
                        return function() {
                            showDayBookings(date, bks);
                        };
                    })(dateStr, dayBookings);
                }

                container.appendChild(dayDiv);
            }
        }

        function showDayBookings(date, dayBookings) {
            document.getElementById('dayBookingsTitle').textContent = 'ğŸ“… ' + date + ' ì˜ˆì•½ (' + dayBookings.length + 'ê±´)';
            
            var list = document.getElementById('dayBookingsList');
            list.innerHTML = '';
            
            for (var i = 0; i < dayBookings.length; i++) {
                var b = dayBookings[i];
                var card = document.createElement('div');
                card.className = 'booking-card';
                card.style.marginBottom = '15px';
                
                card.innerHTML = '<div class="customer-name">' + b.name + '</div>' +
                    '<div class="info-item">ğŸ“ ' + b.phone + '</div>' +
                    '<div class="info-item">ğŸ“ ' + b.address + '</div>' +
                    '<div class="info-item">ğŸ  ' + b.service + '</div>';
                
                list.appendChild(card);
            }
            
            document.getElementById('dayBookingsModal').classList.add('show');
        }

        function hideDayBookings() {
            document.getElementById('dayBookingsModal').classList.remove('show');
        }

        function editManager(name) {
            console.log('âœï¸ ë§¤ë‹ˆì € ìˆ˜ì •:', name);
            
            // ë§¤ë‹ˆì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            var managerId = localStorage.getItem('managerName:' + name);
            if (!managerId) {
                alert('ë§¤ë‹ˆì € ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            var managerData = localStorage.getItem('manager:' + managerId);
            if (!managerData) {
                alert('ë§¤ë‹ˆì € ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            var manager = JSON.parse(managerData);
            
            var newPhone = prompt('ì „í™”ë²ˆí˜¸:', manager.phone);
            if (newPhone === null) return;
            
            var newAge = prompt('ë‚˜ì´:', manager.age);
            if (newAge === null) return;
            
            var newAddress = prompt('ì£¼ì†Œ:', manager.address);
            if (newAddress === null) return;
            
            var newPassword = prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ê·¸ëŒ€ë¡œ ë‘ì„¸ìš”):', manager.password);
            if (newPassword === null) return;
            
            var confirmMsg = 'ë§¤ë‹ˆì € ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n';
            confirmMsg += 'ì´ë¦„: ' + manager.name + '\n';
            confirmMsg += 'ì „í™”ë²ˆí˜¸: ' + manager.phone + ' â†’ ' + newPhone + '\n';
            confirmMsg += 'ë‚˜ì´: ' + manager.age + ' â†’ ' + newAge + '\n';
            confirmMsg += 'ì£¼ì†Œ: ' + manager.address + ' â†’ ' + newAddress + '\n';
            if (newPassword !== manager.password) {
                confirmMsg += 'ë¹„ë°€ë²ˆí˜¸: ë³€ê²½ë¨';
            }
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ë§¤ë‹ˆì € ìˆ˜ì • ì·¨ì†Œ');
                    return;
                }
                
                console.log('âœ… ë§¤ë‹ˆì € ìˆ˜ì • ì§„í–‰');
                
                manager.phone = newPhone;
                manager.age = newAge;
                manager.address = newAddress;
                manager.password = newPassword;
                manager.updatedAt = new Date().toISOString();
                
                localStorage.setItem('manager:' + managerId, JSON.stringify(manager));
                
                console.log('âœ… ë§¤ë‹ˆì € ìˆ˜ì • ì™„ë£Œ');
                alert('âœ… ë§¤ë‹ˆì € ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadMgrs();
            });
        }

        function deleteManager(name) {
            console.log('ğŸ”´ deleteManager í˜¸ì¶œ:', name);
            showConfirm('ì •ë§ë¡œ "' + name + '" ê´€ë¦¬ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                console.log('Confirm ê²°ê³¼:', result);
                
                if (!result) {
                    console.log('ì‚­ì œ ì·¨ì†Œë¨');
                    return;
                }
                
                console.log('ì‚­ì œ ì§„í–‰ ì¤‘...');
                var idx = managers.indexOf(name);
                if (idx > -1) {
                    managers.splice(idx, 1);
                    localStorage.setItem('managers', JSON.stringify(managers));
                    
                    var managerId = localStorage.getItem('managerName:' + name);
                    if (managerId) {
                        localStorage.removeItem('manager:' + managerId);
                        localStorage.removeItem('managerName:' + name);
                    }
                    
                    loadMgrs();
                    alert('âœ… ê´€ë¦¬ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    console.log('âœ… ì‚­ì œ ì™„ë£Œ');
                }
            });
        }

        function toggleMgr() {
            console.log('ê´€ë¦¬ì ì„¹ì…˜ í† ê¸€');
            mgrOpen = !mgrOpen;
            document.getElementById('managerList').style.display = mgrOpen ? 'grid' : 'none';
        }

        function toggleNew() {
            console.log('ì‹ ê·œì˜ˆì•½ ì„¹ì…˜ í† ê¸€');
            newOpen = !newOpen;
            document.getElementById('newBookingList').style.display = newOpen ? 'block' : 'none';
        }

        function toggleBook() {
            console.log('ì˜ˆì•½ ì„¹ì…˜ í† ê¸€');
            bookOpen = !bookOpen;
            document.getElementById('bookingSection').style.display = bookOpen ? 'block' : 'none';
        }

        function toggleFinance() {
            console.log('ì¬ì •ê´€ë¦¬ ì„¹ì…˜ í† ê¸€');
            financeOpen = !financeOpen;
            document.getElementById('financeSection').style.display = financeOpen ? 'block' : 'none';
        }

        function showAddModal() {
            console.log('ê´€ë¦¬ì ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°');
            document.getElementById('addManagerModal').classList.add('show');
        }

        function hideAddModal() {
            console.log('ê´€ë¦¬ì ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°');
            document.getElementById('addManagerModal').classList.remove('show');
        }

        function addMgr() {
            console.log('ê´€ë¦¬ì ì¶”ê°€ ì‹œë„');
            var name = document.getElementById('managerName').value.trim();
            var age = document.getElementById('managerAge').value.trim();
            var phone = document.getElementById('managerPhone').value.trim();
            var address = document.getElementById('managerAddress').value.trim();
            var userId = document.getElementById('managerId').value.trim();
            var password = document.getElementById('managerPassword').value.trim();

            if (!name || !age || !phone || !address || !userId || !password) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (managers.indexOf(name) !== -1) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤!');
                return;
            }

            var confirmMsg = 'ìƒˆ ë§¤ë‹ˆì €ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ë¦„: ' + name + '\në‚˜ì´: ' + age + '\nì „í™”ë²ˆí˜¸: ' + phone + '\nì•„ì´ë””: ' + userId;
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ë§¤ë‹ˆì € ë“±ë¡ ì·¨ì†Œ');
                    return;
                }
                
                console.log('âœ… ê´€ë¦¬ì ì¶”ê°€ ì§„í–‰');
                var managerData = { name: name, age: age, phone: phone, address: address, userId: userId, password: password };
                managers.push(name);
                localStorage.setItem('managers', JSON.stringify(managers));
                localStorage.setItem('manager:' + userId, JSON.stringify(managerData));
                localStorage.setItem('managerName:' + name, userId);

                document.getElementById('managerName').value = '';
                document.getElementById('managerAge').value = '';
                document.getElementById('managerPhone').value = '';
                document.getElementById('managerAddress').value = '';
                document.getElementById('managerId').value = '';
                document.getElementById('managerPassword').value = '';

                hideAddModal();
                if (!mgrOpen) toggleMgr();
                loadMgrs();
                alert('âœ… ' + name + ' ê´€ë¦¬ì íšŒì›ê°€ì… ì™„ë£Œ!\n\nì•„ì´ë””: ' + userId + '\në¹„ë°€ë²ˆí˜¸: ' + password);
            });
        }

        function loadBooks() {
            console.log('ğŸ“‹ ì˜ˆì•½ ë¡œë“œ ì‹œì‘');
            bookings = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && key.indexOf('booking:') === 0) {
                    try {
                        var booking = JSON.parse(localStorage.getItem(key));
                        bookings.push(booking);
                        console.log('  - ë¡œë“œ:', booking.name, '/', booking.status);
                    } catch (e) {
                        console.log('  - ì—ëŸ¬:', e);
                    }
                }
            }
            console.log('ì´ ' + bookings.length + 'ê±´ ë¡œë“œ ì™„ë£Œ');
            
            // ìŠ¤ë§ˆíŠ¸ ì •ë ¬: ë‚ ì§œ â†’ ì‹œê°„ëŒ€ â†’ ì•„íŒŒíŠ¸ â†’ ë™
            bookings.sort(function(a, b) {
                // 1ìˆœìœ„: ë‚ ì§œ
                var dateA = a.serviceDate || '9999-12-31';
                var dateB = b.serviceDate || '9999-12-31';
                if (dateA !== dateB) {
                    return dateA.localeCompare(dateB);
                }
                
                // 2ìˆœìœ„: ì‹œê°„ëŒ€
                var timeOrderA = getTimeSlotOrder(a.timeSlots);
                var timeOrderB = getTimeSlotOrder(b.timeSlots);
                if (timeOrderA !== timeOrderB) {
                    return timeOrderA - timeOrderB;
                }
                
                // 3ìˆœìœ„: ì•„íŒŒíŠ¸ ì´ë¦„
                var aptA = extractApartmentName(a.address);
                var aptB = extractApartmentName(b.address);
                if (aptA !== aptB) {
                    return aptA.localeCompare(aptB);
                }
                
                // 4ìˆœìœ„: ë™ ë²ˆí˜¸
                var dongA = extractDongNumber(a.address);
                var dongB = extractDongNumber(b.address);
                return dongA - dongB;
            });
            
            console.log('âœ… ìŠ¤ë§ˆíŠ¸ ì •ë ¬ ì™„ë£Œ (ë‚ ì§œâ†’ì‹œê°„â†’ì•„íŒŒíŠ¸â†’ë™)');
            renderNewBooks();
            renderBooks();
            renderFinance();
            updateStats();
        }
        
        // ì‹œê°„ëŒ€ ìˆœì„œ ì¶”ì¶œ (ì‘ì€ ìˆ«ìê°€ ë¨¼ì €)
        function getTimeSlotOrder(timeSlots) {
            if (!timeSlots || timeSlots.length === 0) return 999;
            
            var slot = timeSlots[0]; // ì²« ë²ˆì§¸ ì‹œê°„ëŒ€ ê¸°ì¤€
            if (slot.indexOf('ì˜¤ì „') !== -1 || slot.indexOf('9') !== -1) return 1;
            if (slot.indexOf('ì˜¤í›„ 1') !== -1 || slot.indexOf('13') !== -1) return 2;
            if (slot.indexOf('ì˜¤í›„ 4') !== -1 || slot.indexOf('16') !== -1) return 3;
            if (slot.indexOf('ì¢…ì¼') !== -1) return 0; // ì¢…ì¼ì€ ê°€ì¥ ë¨¼ì €
            return 999;
        }
        
        // ì£¼ì†Œì—ì„œ ì•„íŒŒíŠ¸ ì´ë¦„ ì¶”ì¶œ
        function extractApartmentName(address) {
            if (!address) return '';
            
            // "ì•„íŒŒíŠ¸" ë˜ëŠ” "APT" ì•ì˜ ë‹¨ì–´ ì¶”ì¶œ
            var aptMatch = address.match(/([ê°€-í£A-Za-z0-9]+(?:ì•„íŒŒíŠ¸|APT|ë¹Œë¼|íƒ€ì›Œ|íŒ°ë¦¬ìŠ¤))/i);
            if (aptMatch) {
                return aptMatch[1];
            }
            
            return '';
        }
        
        // ì£¼ì†Œì—ì„œ ë™ ë²ˆí˜¸ ì¶”ì¶œ
        function extractDongNumber(address) {
            if (!address) return 999999;
            
            // "101ë™", "1ë™", "Aë™" ë“± ì¶”ì¶œ
            var dongMatch = address.match(/(\d+)ë™/);
            if (dongMatch) {
                return parseInt(dongMatch[1]);
            }
            
            // ë™ì´ ì—†ìœ¼ë©´ ëìœ¼ë¡œ
            return 999999;
        }

        function renderNewBooks() {
            var div = document.getElementById('newBookingList');
            // ë°°ì •ì „ì†¡ë˜ì§€ ì•Šì€ ì‹ ê·œì˜ˆì•½ë§Œ í‘œì‹œ
            var newBookings = bookings.filter(function(b) { 
                return b.status === 'received' && b.assignmentSent !== true; 
            });

            if (newBookings.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì‹ ê·œì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            div.innerHTML = '';
            for (var i = 0; i < newBookings.length; i++) {
                var b = newBookings[i];
                renderBookingCard(b, div);
            }
        }

        function setFilter(filter) {
            console.log('í•„í„° ë³€ê²½:', filter);
            curFilter = filter;
            var btns = document.querySelectorAll('.filter-btn');
            for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
            event.target.classList.add('active');
            renderBooks();
        }

        function renderBooks() {
            var div = document.getElementById('bookingList');
            var filtered = curFilter === 'all' ? bookings : bookings.filter(function(b) { return b.status === curFilter; });

            if (filtered.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            div.innerHTML = '';
            for (var i = 0; i < filtered.length; i++) {
                renderBookingCard(filtered[i], div);
            }
        }

        function renderBookingCard(b, container) {
            var statusNames = { 'received': 'ì˜ˆì•½ì ‘ìˆ˜', 'confirmed': 'ì˜ˆì•½í™•ì •', 'scheduled': 'ìŠ¤ì¼€ì¤„í”½ìŠ¤', 'started': 'ì‘ì—…ì‹œì‘', 'completed': 'ì‘ì—…ì™„ë£Œ', 'paid': 'ì…ê¸ˆì™„ë£Œ' };
            var statusColors = { 'received': '#e67e22', 'confirmed': '#f39c12', 'scheduled': '#9b59b6', 'started': '#3498db', 'completed': '#27ae60', 'paid': '#1abc9c' };

            var card = document.createElement('div');
            card.className = 'booking-card';
            
            var name = document.createElement('div');
            name.className = 'customer-name';
            name.textContent = b.name;
            card.appendChild(name);
            
            var info1 = document.createElement('div');
            info1.className = 'info-item';
            info1.textContent = 'ğŸ“ ' + b.phone;
            card.appendChild(info1);
            
            var info2 = document.createElement('div');
            info2.className = 'info-item';
            info2.textContent = 'ğŸ“ ' + b.address;
            card.appendChild(info2);
            
            var info3 = document.createElement('div');
            info3.className = 'info-item';
            info3.textContent = 'ğŸ  ' + b.service;
            card.appendChild(info3);
            
            var info4 = document.createElement('div');
            info4.className = 'info-item';
            info4.textContent = 'ğŸ“… ' + (b.serviceDate || 'ë¯¸ì§€ì •');
            card.appendChild(info4);
            
            // ê³ ê° í¬ë§ ì‹œê°„ëŒ€ í‘œì‹œ
            if (b.timeSlots && b.timeSlots.length > 0) {
                var info5 = document.createElement('div');
                info5.className = 'info-item';
                info5.style.cssText = 'background: #fff3cd; color: #856404; padding: 8px 12px; border-radius: 8px; font-weight: 600; margin-top: 8px;';
                info5.textContent = 'ğŸ• ê³ ê° í¬ë§: ' + b.timeSlots.join(', ');
                card.appendChild(info5);
            }
            
            // ë§¤ë‹ˆì €ê°€ ì„ íƒí•œ ì •í™•í•œ ì‹œì‘ ì‹œê°„ í‘œì‹œ
            if (b.actualStartTime) {
                var info6 = document.createElement('div');
                info6.className = 'info-item';
                info6.style.cssText = 'background: #d4edda; color: #155724; padding: 8px 12px; border-radius: 8px; font-weight: 700; margin-top: 8px;';
                info6.textContent = 'âœ… ì‹œì‘ ì‹œê°„: ' + b.actualStartTime + ' (ë§¤ë‹ˆì € í™•ì •)';
                card.appendChild(info6);
            }
            
            var badgeContainer = document.createElement('div');
            badgeContainer.style.margin = '12px 0';
            
            if (b.manager && b.manager !== 'ë¯¸ë°°ì •') {
                if (b.assignmentAccepted === true) {
                    var acceptBadge = document.createElement('div');
                    acceptBadge.style.cssText = 'background: #27ae60; color: white; padding: 8px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-block; margin: 8px 8px 8px 0;';
                    acceptBadge.textContent = 'âœ… ìˆ˜ë½ì™„ë£Œ';
                    badgeContainer.appendChild(acceptBadge);
                } else if (b.assignmentSent === true) {
                    var sentBadge = document.createElement('div');
                    sentBadge.style.cssText = 'background: #f39c12; color: white; padding: 8px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-block; margin: 8px 8px 8px 0;';
                    sentBadge.textContent = 'ğŸ“¤ ë°°ì •ì „ì†¡ë¨';
                    badgeContainer.appendChild(sentBadge);
                }
            }
            
            var statusBadge = document.createElement('span');
            statusBadge.className = 'status-badge';
            statusBadge.style.background = statusColors[b.status];
            statusBadge.style.color = 'white';
            statusBadge.textContent = statusNames[b.status];
            badgeContainer.appendChild(statusBadge);
            
            // ë§¤ë‹ˆì €ê°€ ìƒíƒœë¥¼ ë³€ê²½í•œ ê²½ìš° í‘œì‹œ
            if (b.statusChangedBy && b.statusChangedTime) {
                var changedInfo = document.createElement('div');
                changedInfo.style.cssText = 'background: #e8f4f8; color: #00AEEF; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 700; display: inline-block; margin: 8px 8px 8px 0;';
                var time = new Date(b.statusChangedTime);
                var timeStr = time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0');
                changedInfo.textContent = 'ğŸ”„ ' + b.statusChangedBy + 'ë‹˜ì´ ë³€ê²½ (' + timeStr + ')';
                badgeContainer.appendChild(changedInfo);
            }
            
            card.appendChild(badgeContainer);
            
            var actions = document.createElement('div');
            actions.className = 'booking-actions';
            
            var select = document.createElement('select');
            select.style.padding = '10px';
            select.style.border = '2px solid #e0e0e0';
            select.style.borderRadius = '8px';
            var opt0 = document.createElement('option');
            opt0.value = '';
            opt0.textContent = 'ë¯¸ë°°ì •';
            select.appendChild(opt0);
            for (var j = 0; j < managers.length; j++) {
                var opt = document.createElement('option');
                opt.value = managers[j];
                opt.textContent = managers[j];
                if (b.manager === managers[j]) opt.selected = true;
                select.appendChild(opt);
            }
            select.onchange = (function(id) {
                return function() {
                    updateManager(id, this.value);
                };
            })(b.id);
            actions.appendChild(select);
            
            if (b.manager && b.manager !== 'ë¯¸ë°°ì •') {
                if (b.assignmentAccepted !== true && b.assignmentSent !== true) {
                    var assignBtn = document.createElement('button');
                    assignBtn.className = 'btn btn-success';
                    assignBtn.textContent = 'ğŸ“¤ ë°°ì •ì „ì†¡';
                    assignBtn.onclick = (function(id) {
                        return function() {
                            sendAssign(id);
                        };
                    })(b.id);
                    actions.appendChild(assignBtn);
                } else if (b.assignmentSent === true && b.assignmentAccepted !== true) {
                    var waitBtn = document.createElement('button');
                    waitBtn.className = 'btn btn-primary';
                    waitBtn.style.background = '#95a5a6';
                    waitBtn.style.cursor = 'default';
                    waitBtn.textContent = 'ë°°ì •ì „ì†¡ ì™„ë£Œ';
                    actions.appendChild(waitBtn);
                }
            }
            
            // ì…ê¸ˆì™„ë£Œ ë²„íŠ¼ (ì‘ì—…ì™„ë£Œ ìƒíƒœì¼ ë•Œë§Œ í‘œì‹œ)
            if (b.status === 'completed') {
                var paidBtn = document.createElement('button');
                paidBtn.className = 'btn';
                paidBtn.style.background = '#1abc9c';
                paidBtn.textContent = 'ğŸ’° ì…ê¸ˆì™„ë£Œ';
                paidBtn.onclick = (function(id, nm) {
                    return function() {
                        markAsPaid(id, nm);
                    };
                })(b.id, b.name);
                actions.appendChild(paidBtn);
            }
            
            var editBtn = document.createElement('button');
            editBtn.className = 'btn btn-info';
            editBtn.textContent = 'ìˆ˜ì •';
            editBtn.onclick = (function(booking) {
                return function() {
                    editBooking(booking);
                };
            })(b);
            actions.appendChild(editBtn);
            
            var delBtn = document.createElement('button');
            delBtn.className = 'btn btn-danger';
            delBtn.textContent = 'ì‚­ì œ';
            delBtn.onclick = (function(id, nm) {
                return function() {
                    deleteBooking(id, nm);
                };
            })(b.id, b.name);
            actions.appendChild(delBtn);
            
            card.appendChild(actions);
            container.appendChild(card);
        }

        function renderFinance() {
            console.log('ğŸ’° ì¬ì •ê´€ë¦¬ ë Œë”ë§ ì‹œì‘');
            var tbody = document.getElementById('financeBody');
            tbody.innerHTML = '';
            
            var completedBookings = bookings.filter(function(b) { 
                var isCompleted = b.status === 'completed' || b.status === 'paid';
                console.log('  - ' + b.name + ' (' + b.status + '): ' + (isCompleted ? 'O í¬í•¨' : 'X ì œì™¸'));
                return isCompleted;
            });

            console.log('ì™„ë£Œëœ ì˜ˆì•½: ' + completedBookings.length + 'ê±´');

            if (completedBookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" style="text-align: center; color: #999; padding: 40px;">ì™„ë£Œëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤<br><small>(ì‘ì—…ì™„ë£Œ ë˜ëŠ” ì…ê¸ˆì™„ë£Œ ìƒíƒœë§Œ í‘œì‹œë©ë‹ˆë‹¤)</small></td></tr>';
                return;
            }

            // ì´ê³„ ê³„ì‚°
            var totalRevenue = 0;
            var totalManagerPay = 0;
            var totalProfit = 0;
            var totalUnpaid = 0;

            for (var i = 0; i < completedBookings.length; i++) {
                var b = completedBookings[i];
                console.log('ì¬ì • í–‰ ìƒì„±:', b.name);
                
                var row = document.createElement('tr');
                
                // 1. ë²ˆí˜¸
                var numCell = document.createElement('td');
                numCell.textContent = (i + 1);
                numCell.style.textAlign = 'center';
                row.appendChild(numCell);
                
                // 2. ì ‘ìˆ˜ë‚ ì§œ
                var receivedDateCell = document.createElement('td');
                receivedDateCell.textContent = b.receivedDate || b.createdAt || '-';
                row.appendChild(receivedDateCell);
                
                // 3. ì„œë¹„ìŠ¤ë‚ ì§œ
                var serviceDateCell = document.createElement('td');
                serviceDateCell.textContent = b.serviceDate || 'ë¯¸ì§€ì •';
                row.appendChild(serviceDateCell);
                
                // 4. ì´ë¦„/ì „í™”/ì£¼ì†Œ
                var contactCell = document.createElement('td');
                contactCell.innerHTML = '<strong>' + b.name + '</strong><br><small>' + b.phone + '</small><br><small style="color:#666;">' + b.address + '</small>';
                row.appendChild(contactCell);
                
                // 5. í‰í˜•
                var sizeCell = document.createElement('td');
                sizeCell.textContent = extractSize(b.size || '', b.service || '');
                sizeCell.style.textAlign = 'center';
                row.appendChild(sizeCell);
                
                // 6. ì„œë¹„ìŠ¤
                var serviceCell = document.createElement('td');
                serviceCell.textContent = extractService(b.service || '');
                row.appendChild(serviceCell);
                
                // 7. ë§¤ë‹ˆì €
                var managerCell = document.createElement('td');
                managerCell.textContent = b.manager || 'ë¯¸ë°°ì •';
                managerCell.style.textAlign = 'center';
                row.appendChild(managerCell);
                
                // 8. ì‘ì—…í˜„í™©
                var statusCell = document.createElement('td');
                statusCell.textContent = b.status === 'paid' ? 'ì…ê¸ˆì™„ë£Œ' : 'ì‘ì—…ì™„ë£Œ';
                statusCell.style.textAlign = 'center';
                statusCell.style.fontWeight = 'bold';
                statusCell.style.color = b.status === 'paid' ? '#27ae60' : '#f39c12';
                row.appendChild(statusCell);
                
                // 9. ì´ë§¤ì¶œ (í¸ì§‘ ê°€ëŠ¥)
                var revenue = b.revenue || getPrice(b.size || '', b.service || '');
                totalRevenue += revenue;
                var revenueCell = document.createElement('td');
                revenueCell.innerHTML = '<span class="editable" onclick="editField(\'' + b.id + '\', \'revenue\', ' + revenue + ')">' + revenue.toLocaleString() + '</span>';
                revenueCell.style.textAlign = 'right';
                revenueCell.style.fontWeight = 'bold';
                row.appendChild(revenueCell);
                
                // 10. ë§¤ë‹ˆì €í˜ì´ (í¸ì§‘ ê°€ëŠ¥)
                var managerPay = b.managerPay || 0;
                totalManagerPay += managerPay;
                var payCell = document.createElement('td');
                payCell.innerHTML = '<span class="editable" onclick="editField(\'' + b.id + '\', \'managerPay\', ' + managerPay + ')">' + managerPay.toLocaleString() + '</span>';
                payCell.style.textAlign = 'right';
                payCell.style.color = '#e74c3c';
                row.appendChild(payCell);
                
                // 11. ìˆœì´ìµ (ìë™ ê³„ì‚°)
                var profit = revenue - managerPay;
                totalProfit += profit;
                var profitCell = document.createElement('td');
                profitCell.textContent = profit.toLocaleString();
                profitCell.style.textAlign = 'right';
                profitCell.style.fontWeight = 'bold';
                profitCell.style.color = profit >= 0 ? '#27ae60' : '#e74c3c';
                row.appendChild(profitCell);
                
                // 12. ê²°ì œë°©ë²• (í¸ì§‘ ê°€ëŠ¥)
                var paymentCell = document.createElement('td');
                paymentCell.innerHTML = '<span class="editable" onclick="editPaymentMethod(\'' + b.id + '\', \'' + (b.paymentMethod || '') + '\')">' + (b.paymentMethod || 'ë¯¸ì§€ì •') + '</span>';
                paymentCell.style.textAlign = 'center';
                row.appendChild(paymentCell);
                
                // 13. ì…ê¸ˆì¼ (í¸ì§‘ ê°€ëŠ¥)
                var depositDateCell = document.createElement('td');
                depositDateCell.innerHTML = '<span class="editable" onclick="editDepositDate(\'' + b.id + '\', \'' + (b.depositDate || '') + '\')">' + (b.depositDate || '-') + '</span>';
                depositDateCell.style.textAlign = 'center';
                row.appendChild(depositDateCell);
                
                // 14. ë¯¸ìˆ˜ê¸ˆ (í¸ì§‘ ê°€ëŠ¥)
                var unpaid = b.unpaid || 0;
                totalUnpaid += unpaid;
                var unpaidCell = document.createElement('td');
                unpaidCell.innerHTML = '<span class="editable" onclick="editField(\'' + b.id + '\', \'unpaid\', ' + unpaid + ')">' + unpaid.toLocaleString() + '</span>';
                unpaidCell.style.textAlign = 'right';
                unpaidCell.style.color = unpaid > 0 ? '#e74c3c' : '#27ae60';
                unpaidCell.style.fontWeight = 'bold';
                row.appendChild(unpaidCell);
                
                // 15. êµ¬ë¶„ (í¸ì§‘ ê°€ëŠ¥)
                var categoryCell = document.createElement('td');
                categoryCell.innerHTML = '<span class="editable" onclick="editCategory(\'' + b.id + '\', \'' + (b.category || '') + '\')">' + (b.category || 'ê°œì¸') + '</span>';
                categoryCell.style.textAlign = 'center';
                row.appendChild(categoryCell);
                
                // 16. ìˆ˜ì • ë²„íŠ¼
                var editCell = document.createElement('td');
                var editBtn = document.createElement('button');
                editBtn.textContent = 'âœï¸';
                editBtn.className = 'btn btn-info';
                editBtn.style.padding = '6px 12px';
                editBtn.onclick = (function(booking) {
                    return function() {
                        editFinanceRecord(booking);
                    };
                })(b);
                editCell.appendChild(editBtn);
                editCell.style.textAlign = 'center';
                row.appendChild(editCell);
                
                tbody.appendChild(row);
            }
            
            // ì´ê³„ í–‰ ì¶”ê°€
            var totalRow = document.createElement('tr');
            totalRow.style.background = '#f0f8ff';
            totalRow.style.fontWeight = 'bold';
            totalRow.style.borderTop = '3px solid #00AEEF';
            totalRow.innerHTML = 
                '<td colspan="8" style="text-align: right; padding-right: 20px; font-size: 18px;">ì´ê³„</td>' +
                '<td style="text-align: right; color: #2c3e50; font-size: 18px;">' + totalRevenue.toLocaleString() + 'ì›</td>' +
                '<td style="text-align: right; color: #e74c3c; font-size: 18px;">' + totalManagerPay.toLocaleString() + 'ì›</td>' +
                '<td style="text-align: right; color: #27ae60; font-size: 20px;">' + totalProfit.toLocaleString() + 'ì›</td>' +
                '<td colspan="2"></td>' +
                '<td style="text-align: right; color: #e74c3c; font-size: 18px;">' + totalUnpaid.toLocaleString() + 'ì›</td>' +
                '<td colspan="2"></td>';
            tbody.appendChild(totalRow);
            
            console.log('ì¬ì •ê´€ë¦¬ ë Œë”ë§ ì™„ë£Œ - ì´ë§¤ì¶œ:', totalRevenue, '/ ìˆœì´ìµ:', totalProfit);
        }

        // ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜
        function markAsPaid(id, name) {
            showConfirm('"' + name + '" ê³ ê°ì˜ ì…ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆê¹Œ?', function(result) {
                if (!result) return;
                
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === id) {
                        bookings[i].status = 'paid';
                        bookings[i].depositDate = new Date().toISOString().split('T')[0];
                        bookings[i].unpaid = 0;
                        localStorage.setItem('booking:' + id, JSON.stringify(bookings[i]));
                        
                        // Google Sheets ì…ê¸ˆ ì²˜ë¦¬
                        syncPaymentToGoogleSheets(bookings[i]);
                        
                        alert('âœ… ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        loadBooks();
                        break;
                    }
                }
            });
        }

        // Google Sheets ë™ê¸°í™” í•¨ìˆ˜
        function syncToGoogleSheets(booking, action) {
            if (!GOOGLE_SCRIPT_URL) {
                console.log('âš ï¸ GOOGLE_SCRIPT_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ“Š Google Sheets ë™ê¸°í™”:', booking.name, action);
            
            var payload = {
                action: action || 'updateStatus',
                bookingId: booking.id,
                workStatus: booking.status === 'completed' ? 'ì™„ë£Œ' : 
                           booking.status === 'started' ? 'ì§„í–‰ì¤‘' : 
                           booking.status === 'scheduled' ? 'í™•ì •' : 'ëŒ€ê¸°',
                worker: booking.manager || '',
                actualStartTime: booking.actualStartTime || ''
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(function() {
                console.log('âœ… Google Sheets ë™ê¸°í™” ì™„ë£Œ');
            })
            .catch(function(error) {
                console.error('âŒ Google Sheets ë™ê¸°í™” ì‹¤íŒ¨:', error);
            });
        }
        
        // ì…ê¸ˆ ì²˜ë¦¬ Google Sheets ë™ê¸°í™”
        function syncPaymentToGoogleSheets(booking) {
            if (!GOOGLE_SCRIPT_URL) {
                console.log('âš ï¸ GOOGLE_SCRIPT_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ’° ì…ê¸ˆ ì²˜ë¦¬ ë™ê¸°í™”:', booking.name);
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'updatePayment',
                    bookingId: booking.id
                })
            })
            .then(function() {
                console.log('âœ… ì…ê¸ˆ ì²˜ë¦¬ ë™ê¸°í™” ì™„ë£Œ');
            })
            .catch(function(error) {
                console.error('âŒ ì…ê¸ˆ ì²˜ë¦¬ ë™ê¸°í™” ì‹¤íŒ¨:', error);
            });
        }

        function updateManager(id, mgr) {
            console.log('ê´€ë¦¬ì ë³€ê²½ ì‹œë„:', id, mgr);
            
            var bookingName = '';
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].id === id) {
                    bookingName = bookings[i].name;
                    break;
                }
            }
            
            var confirmMsg = mgr ? 
                'ë§¤ë‹ˆì €ë¥¼ "' + mgr + '"ë‹˜ìœ¼ë¡œ ë°°ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê³ ê°: ' + bookingName :
                'ë§¤ë‹ˆì € ë°°ì •ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê³ ê°: ' + bookingName;
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ë§¤ë‹ˆì € ë°°ì • ì·¨ì†Œ');
                    loadBooks(); // select ì„ íƒ ì›ë³µì„ ìœ„í•´ ë‹¤ì‹œ ë Œë”ë§
                    return;
                }
                
                console.log('âœ… ê´€ë¦¬ì ë³€ê²½ ì§„í–‰:', id, mgr);
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === id) {
                        bookings[i].manager = mgr;
                        bookings[i].assignmentSent = false;
                        bookings[i].assignmentAccepted = false;
                        localStorage.setItem('booking:' + id, JSON.stringify(bookings[i]));
                        alert('âœ… ë§¤ë‹ˆì €ê°€ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        loadBooks();
                        break;
                    }
                }
            });
        }

        function sendAssign(id) {
            console.log('ë°°ì • ì „ì†¡ ì‹œë„:', id);
            var booking = null;
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].id === id) {
                    booking = bookings[i];
                    break;
                }
            }
            if (!booking || !booking.manager || booking.manager === 'ë¯¸ë°°ì •') {
                alert('ë¨¼ì € ê´€ë¦¬ìë¥¼ ë°°ì •í•´ì£¼ì„¸ìš”!');
                return;
            }

            var confirmMsg = 'ì¼ì •ì„ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në§¤ë‹ˆì €: ' + booking.manager + '\nê³ ê°: ' + booking.name + '\në‚ ì§œ: ' + booking.serviceDate;
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ë°°ì • ì „ì†¡ ì·¨ì†Œ');
                    return;
                }
                
                console.log('âœ… ë°°ì • ì „ì†¡ ì§„í–‰');
                booking.assignmentSent = true;
                booking.assignmentSentTime = new Date().toISOString();
                localStorage.setItem('booking:' + id, JSON.stringify(booking));
                
                alert('âœ… ' + booking.manager + 'ë‹˜ì—ê²Œ ì¼ì •ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadBooks();
            });
        }

        function changeStatus(id, newStatus) {
            console.log('ğŸ”´ changeStatus í˜¸ì¶œ:', id, newStatus);
            var statusNames = { 'received': 'ì˜ˆì•½ì ‘ìˆ˜', 'confirmed': 'ì˜ˆì•½í™•ì •', 'started': 'ì‘ì—…ì‹œì‘', 'completed': 'ì‘ì—…ì™„ë£Œ', 'paid': 'ì…ê¸ˆì™„ë£Œ' };
            
            showConfirm('ìƒíƒœë¥¼ "' + statusNames[newStatus] + '"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                console.log('Confirm ê²°ê³¼:', result);
                
                if (!result) {
                    console.log('ìƒíƒœ ë³€ê²½ ì·¨ì†Œë¨');
                    return;
                }
                
                console.log('âœ… ìƒíƒœ ë³€ê²½ ì§„í–‰ ì¤‘...');
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === id) {
                        bookings[i].status = newStatus;
                        bookings[i].statusChangedBy = 'ê´€ë¦¬ì';
                        bookings[i].statusChangedTime = new Date().toISOString();
                        localStorage.setItem('booking:' + id, JSON.stringify(bookings[i]));
                        console.log('âœ… ìƒíƒœ ë³€ê²½ ì™„ë£Œ:', bookings[i].name, '->', newStatus);
                        loadBooks();
                        alert('âœ… ìƒíƒœê°€ "' + statusNames[newStatus] + '"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        break;
                    }
                }
            });
        }

        function deleteBooking(id, name) {
            console.log('ğŸ”´ deleteBooking í˜¸ì¶œ:', id, name);
            showConfirm('ì •ë§ë¡œ "' + name + '"ë‹˜ì˜ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                console.log('Confirm ê²°ê³¼:', result);
                
                if (!result) {
                    console.log('ì˜ˆì•½ ì‚­ì œ ì·¨ì†Œë¨');
                    return;
                }
                
                console.log('ì˜ˆì•½ ì‚­ì œ ì§„í–‰ ì¤‘...');
                localStorage.removeItem('booking:' + id);
                loadBooks();
                alert('âœ… ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('âœ… ì˜ˆì•½ ì‚­ì œ ì™„ë£Œ');
            });
        }

        function editBooking(booking) {
            console.log('âœï¸ ì˜ˆì•½ ìˆ˜ì •:', booking.name);
            
            var newName = prompt('ì´ë¦„:', booking.name);
            if (newName === null) return;
            
            var newPhone = prompt('ì „í™”ë²ˆí˜¸:', booking.phone);
            if (newPhone === null) return;
            
            var newAddress = prompt('ì£¼ì†Œ:', booking.address);
            if (newAddress === null) return;
            
            var newServiceDate = prompt('ì„œë¹„ìŠ¤ ë‚ ì§œ (YYYY-MM-DD):', booking.serviceDate);
            if (newServiceDate === null) return;
            
            var confirmMsg = 'ì˜ˆì•½ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n';
            confirmMsg += 'ì´ë¦„: ' + booking.name + ' â†’ ' + newName + '\n';
            confirmMsg += 'ì „í™”ë²ˆí˜¸: ' + booking.phone + ' â†’ ' + newPhone + '\n';
            confirmMsg += 'ì£¼ì†Œ: ' + booking.address + ' â†’ ' + newAddress + '\n';
            confirmMsg += 'ë‚ ì§œ: ' + booking.serviceDate + ' â†’ ' + newServiceDate;
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ì˜ˆì•½ ìˆ˜ì • ì·¨ì†Œ');
                    return;
                }
                
                console.log('âœ… ì˜ˆì•½ ìˆ˜ì • ì§„í–‰');
                
                booking.name = newName;
                booking.phone = newPhone;
                booking.address = newAddress;
                booking.serviceDate = newServiceDate;
                booking.updatedAt = new Date().toISOString();
                
                localStorage.setItem('booking:' + booking.id, JSON.stringify(booking));
                
                console.log('âœ… ì˜ˆì•½ ìˆ˜ì • ì™„ë£Œ');
                alert('âœ… ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadBooks();
            });
        }

        // ì¬ì • ì •ë³´ í¸ì§‘ í•¨ìˆ˜ë“¤
        function editField(bookingId, field, currentValue) {
            var fieldNames = {
                'revenue': 'ì´ë§¤ì¶œ',
                'managerPay': 'ë§¤ë‹ˆì €í˜ì´',
                'unpaid': 'ë¯¸ìˆ˜ê¸ˆ'
            };
            
            var newValue = prompt(fieldNames[field] + ' (ì›):', currentValue);
            if (newValue === null) return;
            
            newValue = parseInt(newValue) || 0;
            
            showConfirm(fieldNames[field] + 'ì„(ë¥¼) ' + newValue.toLocaleString() + 'ì›ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                if (!result) return;
                
                var booking = null;
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === bookingId) {
                        booking = bookings[i];
                        break;
                    }
                }
                
                if (booking) {
                    booking[field] = newValue;
                    localStorage.setItem('booking:' + bookingId, JSON.stringify(booking));
                    alert('âœ… ' + fieldNames[field] + 'ì´(ê°€) ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadBooks();
                }
            });
        }
        
        function editPaymentMethod(bookingId, currentMethod) {
            var methods = ['í˜„ê¸ˆ', 'ì¹´ë“œ', 'ê³„ì¢Œì´ì²´', 'ë¯¸ì§€ì •'];
            var choice = prompt('ê²°ì œë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”:\n1. í˜„ê¸ˆ\n2. ì¹´ë“œ\n3. ê³„ì¢Œì´ì²´\n4. ë¯¸ì§€ì •\n\ní˜„ì¬: ' + (currentMethod || 'ë¯¸ì§€ì •'));
            
            if (choice === null) return;
            
            var methodIndex = parseInt(choice) - 1;
            if (methodIndex < 0 || methodIndex >= methods.length) {
                alert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤!');
                return;
            }
            
            var newMethod = methods[methodIndex];
            
            showConfirm('ê²°ì œë°©ë²•ì„ "' + newMethod + '"(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                if (!result) return;
                
                var booking = null;
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === bookingId) {
                        booking = bookings[i];
                        break;
                    }
                }
                
                if (booking) {
                    booking.paymentMethod = newMethod === 'ë¯¸ì§€ì •' ? '' : newMethod;
                    localStorage.setItem('booking:' + bookingId, JSON.stringify(booking));
                    alert('âœ… ê²°ì œë°©ë²•ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadBooks();
                }
            });
        }
        
        function editDepositDate(bookingId, currentDate) {
            var newDate = prompt('ì…ê¸ˆì¼ (YYYY-MM-DD):', currentDate);
            if (newDate === null) return;
            
            showConfirm('ì…ê¸ˆì¼ì„ "' + newDate + '"(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                if (!result) return;
                
                var booking = null;
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === bookingId) {
                        booking = bookings[i];
                        break;
                    }
                }
                
                if (booking) {
                    booking.depositDate = newDate;
                    localStorage.setItem('booking:' + bookingId, JSON.stringify(booking));
                    alert('âœ… ì…ê¸ˆì¼ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadBooks();
                }
            });
        }
        
        function editCategory(bookingId, currentCategory) {
            var categories = ['ê°œì¸', 'ë²•ì¸'];
            var choice = prompt('êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”:\n1. ê°œì¸\n2. ë²•ì¸\n\ní˜„ì¬: ' + (currentCategory || 'ê°œì¸'));
            
            if (choice === null) return;
            
            var categoryIndex = parseInt(choice) - 1;
            if (categoryIndex < 0 || categoryIndex >= categories.length) {
                alert('ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤!');
                return;
            }
            
            var newCategory = categories[categoryIndex];
            
            showConfirm('êµ¬ë¶„ì„ "' + newCategory + '"(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(result) {
                if (!result) return;
                
                var booking = null;
                for (var i = 0; i < bookings.length; i++) {
                    if (bookings[i].id === bookingId) {
                        booking = bookings[i];
                        break;
                    }
                }
                
                if (booking) {
                    booking.category = newCategory;
                    localStorage.setItem('booking:' + bookingId, JSON.stringify(booking));
                    alert('âœ… êµ¬ë¶„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadBooks();
                }
            });
        }
        
        function editFinanceRecord(booking) {
            console.log('âœï¸ ì¬ì • ì •ë³´ ì¼ê´„ ìˆ˜ì •:', booking.name);
            
            var newRevenue = prompt('ì´ë§¤ì¶œ (ì›):', booking.revenue || getPrice(booking.size || '', booking.service || ''));
            if (newRevenue === null) return;
            newRevenue = parseInt(newRevenue) || 0;
            
            var newManagerPay = prompt('ë§¤ë‹ˆì €í˜ì´ (ì›):', booking.managerPay || 0);
            if (newManagerPay === null) return;
            newManagerPay = parseInt(newManagerPay) || 0;
            
            var newPaymentMethod = prompt('ê²°ì œë°©ë²• (í˜„ê¸ˆ/ì¹´ë“œ/ê³„ì¢Œì´ì²´):', booking.paymentMethod || '');
            if (newPaymentMethod === null) return;
            
            var newDepositDate = prompt('ì…ê¸ˆì¼ (YYYY-MM-DD):', booking.depositDate || '');
            if (newDepositDate === null) return;
            
            var newUnpaid = prompt('ë¯¸ìˆ˜ê¸ˆ (ì›):', booking.unpaid || 0);
            if (newUnpaid === null) return;
            newUnpaid = parseInt(newUnpaid) || 0;
            
            var newCategory = prompt('êµ¬ë¶„ (ê°œì¸/ë²•ì¸):', booking.category || 'ê°œì¸');
            if (newCategory === null) return;
            
            var profit = newRevenue - newManagerPay;
            
            var confirmMsg = 'ì¬ì • ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n';
            confirmMsg += 'ì´ë§¤ì¶œ: ' + newRevenue.toLocaleString() + 'ì›\n';
            confirmMsg += 'ë§¤ë‹ˆì €í˜ì´: ' + newManagerPay.toLocaleString() + 'ì›\n';
            confirmMsg += 'ìˆœì´ìµ: ' + profit.toLocaleString() + 'ì›\n';
            confirmMsg += 'ê²°ì œë°©ë²•: ' + newPaymentMethod + '\n';
            confirmMsg += 'ì…ê¸ˆì¼: ' + newDepositDate + '\n';
            confirmMsg += 'ë¯¸ìˆ˜ê¸ˆ: ' + newUnpaid.toLocaleString() + 'ì›\n';
            confirmMsg += 'êµ¬ë¶„: ' + newCategory;
            
            showConfirm(confirmMsg, function(result) {
                if (!result) {
                    console.log('âŒ ì¬ì • ì •ë³´ ìˆ˜ì • ì·¨ì†Œ');
                    return;
                }
                
                console.log('âœ… ì¬ì • ì •ë³´ ìˆ˜ì • ì§„í–‰');
                
                booking.revenue = newRevenue;
                booking.managerPay = newManagerPay;
                booking.paymentMethod = newPaymentMethod;
                booking.depositDate = newDepositDate;
                booking.unpaid = newUnpaid;
                booking.category = newCategory;
                booking.updatedAt = new Date().toISOString();
                
                localStorage.setItem('booking:' + booking.id, JSON.stringify(booking));
                
                console.log('âœ… ì¬ì • ì •ë³´ ìˆ˜ì • ì™„ë£Œ');
                alert('âœ… ì¬ì • ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                loadBooks();
            });
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = bookings.length;
            document.getElementById('receivedCount').textContent = bookings.filter(function(b) { return b.status === 'received'; }).length;
            document.getElementById('confirmedCount').textContent = bookings.filter(function(b) { return b.status === 'confirmed'; }).length;
            document.getElementById('startedCount').textContent = bookings.filter(function(b) { return b.status === 'started'; }).length;
            document.getElementById('completedCount').textContent = bookings.filter(function(b) { return b.status === 'completed'; }).length;
            document.getElementById('paidCount').textContent = bookings.filter(function(b) { return b.status === 'paid'; }).length;
        }

        function showBigCalendar() {
            console.log('ğŸ“… í° ìº˜ë¦°ë” ì—´ê¸°');
            document.getElementById('bigCalendarModal').classList.add('show');
            bigCalYear = new Date().getFullYear();
            bigCalMonth = new Date().getMonth();
            renderBigCalendar();
        }

        function hideBigCalendar() {
            document.getElementById('bigCalendarModal').classList.remove('show');
        }

        function prevBigMonth() {
            bigCalMonth--;
            if (bigCalMonth < 0) {
                bigCalMonth = 11;
                bigCalYear--;
            }
            renderBigCalendar();
        }

        function nextBigMonth() {
            bigCalMonth++;
            if (bigCalMonth > 11) {
                bigCalMonth = 0;
                bigCalYear++;
            }
            renderBigCalendar();
        }

        function renderBigCalendar() {
            var monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('bigCalendarTitle').textContent = bigCalYear + 'ë…„ ' + monthNames[bigCalMonth];

            var firstDay = new Date(bigCalYear, bigCalMonth, 1).getDay();
            var daysInMonth = new Date(bigCalYear, bigCalMonth + 1, 0).getDate();

            var container = document.getElementById('bigCalendarDays');
            container.innerHTML = '';

            for (var i = 0; i < firstDay; i++) {
                var empty = document.createElement('div');
                empty.className = 'calendar-big-day empty';
                container.appendChild(empty);
            }

            for (var day = 1; day <= daysInMonth; day++) {
                var dateStr = bigCalYear + '-' + String(bigCalMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                var dayBookings = bookings.filter(function(b) { return b.serviceDate === dateStr; });

                var dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-big-day';
                
                var numDiv = document.createElement('div');
                numDiv.className = 'calendar-big-day-number';
                numDiv.textContent = day;
                dayDiv.appendChild(numDiv);

                if (dayBookings.length > 0) {
                    dayDiv.classList.add('has-bookings');
                    var countDiv = document.createElement('div');
                    countDiv.className = 'calendar-booking-count';
                    countDiv.textContent = dayBookings.length + 'ê±´';
                    dayDiv.appendChild(countDiv);

                    dayDiv.onclick = (function(date, bks) {
                        return function() {
                            showDayBookings(date, bks);
                        };
                    })(dateStr, dayBookings);
                }

                container.appendChild(dayDiv);
            }
        }

        function exportExcel() {
            console.log('ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹œì‘');
            if (bookings.length === 0) { 
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
                return; 
            }
            
            var csv = 'ë‚ ì§œ(####),ì´ë¦„/ì „í™”/ì£¼ì†Œ,í‰í˜•(ìˆ˜ì¹˜íŒ),ì„œë¹„ìŠ¤(ë¶„ë¥˜),ê´€ë¦¬ì(ë‹´ë‹¹),ìƒíƒœ(ê²°ì œìˆ˜ë‹¨),ë§¤ì¶œ(VATë³„ë„),ë§¤ë‹ˆì €ë¹„ìš©(ë³€ë™),ìˆœì´ìµ(ê³µí—Œì´ìµ)\n';
            
            var totalRevenue = 0;
            var totalCost = 0;
            var totalProfit = 0;
            var completedCount = 0;
            
            for (var i = 0; i < bookings.length; i++) {
                var b = bookings[i];
                var sizeParts = b.service.split(' - ');
                var size = '';
                var serviceType = '';
                
                if (sizeParts.length >= 2) {
                    size = sizeParts[0];
                    serviceType = sizeParts[1];
                } else {
                    size = '';
                    serviceType = b.service;
                }
                
                var revenue = getPrice(size, serviceType);
                
                var cost = 0;
                var profit = 0;
                
                if (b.status === 'completed' || b.status === 'paid') {
                    cost = MANAGER_COST;
                    profit = revenue - cost;
                    totalRevenue += revenue;
                    totalCost += cost;
                    totalProfit += profit;
                    completedCount++;
                }
                
                var statusText = b.status === 'received' ? 'ì˜ˆì•½ì ‘ìˆ˜' : 
                                b.status === 'confirmed' ? 'ì˜ˆì•½í™•ì •' :
                                b.status === 'started' ? 'ì‘ì—…ì‹œì‘' :
                                b.status === 'completed' ? 'ì‘ì—…ì™„ë£Œ' :
                                b.status === 'paid' ? 'ì…ê¸ˆì™„ë£Œ' : b.status;
                
                var contact = b.name + ' / ' + b.phone + ' / ' + b.address;
                
                var extractedSize = extractSize(size, serviceType);
                if (extractedSize === '-') {
                    extractedSize = extractSize(b.service, '');
                }
                
                csv += '"' + (b.serviceDate || 'ë¯¸ì§€ì •') + '","' + contact + '","' + 
                       extractedSize + '","' + extractService(serviceType) + '","' + 
                       (b.manager || 'ë¯¸ë°°ì •') + '","' + statusText + '","' + 
                       revenue + '","' + cost + '","' + profit + '"\n';
            }
            
            csv += '\n"ì´ í•©ê³„(' + completedCount + 'ê±´)","","","","","","' + totalRevenue + '","' + totalCost + '","' + totalProfit + '"\n';
            
            var BOM = "\uFEFF";
            var blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ê¹¨ë—í•œì§‘_ì¬ì •ê´€ë¦¬_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
            console.log('  ì´ ë§¤ì¶œ:', totalRevenue.toLocaleString());
            console.log('  ì´ ë¹„ìš©:', totalCost.toLocaleString());
            console.log('  ì´ ìˆœì´ìµ:', totalProfit.toLocaleString());
        }

        window.addEventListener('load', function() {
            console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            loadMgrs();
            loadBooks();
            setInterval(loadBooks, 5000);
        });
    </script>
</body>
</html>
