<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘ - ë°°ê´€ ìŠ¤ì¼€ì¼ë§ ì˜ˆì•½</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; padding: 40px 30px 30px; text-align: center; }
        .form-container { padding: 40px 30px; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px; }
        input[type="text"], input[type="tel"], textarea { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px; font-family: inherit; }
        input:focus, textarea:focus { outline: none; border-color: #00AEEF; box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.1); }
        .date-selector { background: #f0faff; border: 3px solid #00AEEF; border-radius: 12px; padding: 20px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .date-selector:hover { background: #e0f5ff; transform: scale(1.02); }
        .date-selector.disabled { background: #f5f5f5; border-color: #ccc; cursor: not-allowed; opacity: 0.6; }
        .date-selector-text { font-size: 22px; font-weight: 700; color: #00AEEF; }
        .date-selector-placeholder { color: #999; }
        .service-options { display: flex; flex-direction: column; gap: 15px; }
        .service-card { border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; cursor: pointer; position: relative; transition: all 0.3s; }
        .service-card:hover { border-color: #00AEEF; transform: translateY(-2px); }
        .service-card.selected { border-color: #00AEEF; background: #f0faff; }
        .service-card.disabled { background: #f5f5f5; border-color: #ddd; cursor: not-allowed; opacity: 0.5; }
        .service-content { display: flex; justify-content: space-between; align-items: center; padding-left: 40px; }
        .service-name { font-size: 16px; font-weight: 600; }
        .checkmark { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); height: 24px; width: 24px; border: 2px solid #ddd; border-radius: 50%; }
        .service-card.selected .checkmark { background: #00AEEF; border-color: #00AEEF; }
        .service-card.selected .checkmark:after { content: ""; position: absolute; display: block; left: 7px; top: 3px; width: 6px; height: 12px; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); }
        .submit-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; margin-top: 10px; transition: all 0.3s; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 174, 239, 0.4); }
        .required { color: #e74c3c; }
        .success-message { display: none; background: #d4edda; color: #155724; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #c3e6cb; text-align: center; font-weight: 700; font-size: 18px; }
        .success-message.show { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .price-summary { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; padding: 20px; border-radius: 12px; margin-top: 20px; margin-bottom: 20px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px; }
        .price-row:last-child { margin-bottom: 0; border-top: 2px solid rgba(255,255,255,0.3); padding-top: 10px; font-size: 20px; font-weight: 900; }
        .price-label { opacity: 0.9; }
        .price-value { font-weight: 700; }
        .company-info { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e0e0e0; }
        .company-info-title { font-size: 14px; font-weight: 700; color: #333; margin-bottom: 12px; }
        .company-links { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        .company-link { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; text-decoration: none; color: #333; font-size: 13px; font-weight: 600; transition: all 0.3s; }
        .company-link:hover { border-color: #00AEEF; background: #f0faff; }
        .process-info { font-size: 12px; color: #666; line-height: 1.6; }
        .process-step { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .step-num { background: #00AEEF; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; }
        .calendar-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .calendar-modal.show { display: flex; }
        .calendar-container { background: white; border-radius: 20px; padding: 30px; max-width: 450px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .calendar-nav-btn { width: 50px; height: 50px; border: none; background: #00AEEF; color: white; font-size: 24px; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .calendar-nav-btn:hover { background: #0088CC; }
        .calendar-title { font-size: 24px; font-weight: 700; color: #333; }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 10px; }
        .calendar-weekday { text-align: center; font-weight: 600; color: #666; padding: 10px 0; font-size: 14px; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { aspect-ratio: 1; border: 2px solid #e0e0e0; background: white; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; position: relative; }
        .calendar-day:hover:not(.disabled):not(.empty):not(.full) { background: #00AEEF; color: white; border-color: #00AEEF; }
        .calendar-day.today { border-color: #f39c12; background: #fff3cd; }
        .calendar-day.selected { background: #00AEEF; color: white; border-color: #00AEEF; }
        .calendar-day.disabled { color: #ccc; cursor: not-allowed; background: #f5f5f5; }
        .calendar-day.full { color: #e74c3c; cursor: not-allowed; background: #ffeaea; border-color: #e74c3c; }
        .calendar-day.empty { border: none; cursor: default; }
        .calendar-day .slots-indicator { font-size: 9px; color: #27ae60; margin-top: 2px; }
        .calendar-day.full .slots-indicator { color: #e74c3c; }
        .calendar-close { margin-top: 20px; width: 100%; padding: 15px; background: #95a5a6; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .calendar-close:hover { background: #7f8c8d; }
        .confirm-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
        .confirm-modal.show { display: flex; }
        .confirm-content { background: white; border-radius: 20px; padding: 35px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-height: 90vh; overflow-y: auto; }
        .confirm-title { font-size: 26px; font-weight: 900; color: #333; margin-bottom: 25px; text-align: center; }
        .confirm-info { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        .confirm-row { display: flex; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
        .confirm-row:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .confirm-label { font-weight: 700; color: #555; min-width: 100px; font-size: 15px; }
        .confirm-value { color: #000; font-weight: 600; font-size: 15px; flex: 1; }
        .confirm-buttons { display: flex; gap: 12px; }
        .confirm-buttons button { flex: 1; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: 900; cursor: pointer; transition: all 0.3s; }
        .confirm-buttons .btn-no { background: #95a5a6; color: white; }
        .confirm-buttons .btn-no:hover { background: #7f8c8d; }
        .confirm-buttons .btn-yes { background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; }
        .confirm-buttons .btn-yes:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 174, 239, 0.4); }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 3000; justify-content: center; align-items: center; flex-direction: column; }
        .loading-overlay.show { display: flex; }
        .loading-spinner { width: 50px; height: 50px; border: 5px solid #e0e0e0; border-top-color: #00AEEF; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 20px; font-size: 18px; font-weight: 600; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="background: white; display: inline-block; padding: 20px 40px; border-radius: 15px; margin-bottom: 15px;">
                <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 5px;">(ì£¼)í™ˆì¼€ì–´</div>
                <div style="font-size: 36px; font-weight: 900; color: #000; letter-spacing: -1px;">ê¹¨ë—í•œ<span style="color: #e74c3c;">ì§‘</span></div>
            </div>
            <p style="font-size: 18px; font-weight: 500; margin-top: 15px;">ë°°ê´€ ìŠ¤ì¼€ì¼ë§ ì„œë¹„ìŠ¤ ì˜ˆì•½</p>
        </div>

        <div class="form-container">
            <div class="company-info">
                <div class="company-info-title">ğŸ“Œ (ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘</div>
                <div class="company-links">
                    <a href="http://www.xn--9l0bs0bb58byrk.com/sub0101.php" target="_blank" class="company-link">ğŸŒ íšŒì‚¬ í™ˆí˜ì´ì§€</a>
                    <a href="https://www.youtube.com/@%EA%B9%A8%EC%A7%91%EB%8B%A5%ED%84%B0" target="_blank" class="company-link">ğŸ“º ìœ íŠœë¸Œ ì±„ë„</a>
                </div>
                <div class="process-info">
                    <div style="font-weight: 700; margin-bottom: 10px; font-size: 14px; color: #00AEEF;">ğŸ”§ ë‚œë°©/ìˆ˜ë„ ë°°ê´€ ìŠ¤ì¼€ì¼ë§ ë°©ì‹</div>
                    <div style="font-size: 11px; color: #666; margin-bottom: 10px; background: #e8f4f8; padding: 8px; border-radius: 6px;">
                        <strong>íŠ¹í—ˆ ë²ˆí˜¸ ì œ10-0885390í˜¸</strong> íšë“<br>ë…ìì ì¸ ì¹œí™˜ê²½ ì¥ì¹˜ ì‚¬ìš©
                    </div>
                    <div class="process-step"><span class="step-num">1</span> <strong>ì´ì˜¨í™”ìˆ˜ê¸° ì‚¬ìš©</strong> - ìì²´ ì œì‘ ì´ì˜¨í™”ìˆ˜ê¸°ë¡œ ë¬¼(Hâ‚‚O) ë¶„ìë¥¼ ë¶„í•´í•˜ì—¬ ê°• ì•Œì¹¼ë¦¬ ìˆ˜ì†Œìˆ˜ì™€ ì˜¤ì¡´ìˆ˜ ìƒì„±</div>
                    <div class="process-step"><span class="step-num">2</span> <strong>í™”í•™ì  ìš©í•´ (ìˆ˜ì†Œìˆ˜)</strong> - ìˆ˜ì†Œìˆ˜ê°€ ë°°ê´€ ë‚´ ë…¹ê³¼ ìŠ¬ëŸ¬ì§€ ë¶„ìë¥¼ ë§Œë‚˜ ì•½ 150ë°° íŒ½ì°½ì‹œì¼œ ì‰½ê²Œ ë°•ë¦¬</div>
                    <div class="process-step"><span class="step-num">3</span> <strong>ìƒë¬¼í•™ì  ì‚´ê·  (ì˜¤ì¡´ìˆ˜)</strong> - ì˜¤ì¡´ìˆ˜ë¡œ ë°°ê´€ í‘œë©´ ë©¸ê· , í•­ê· Â·ì‚´ê·  íš¨ê³¼ë¡œ ë°°ê´€ ë‚´ë¶€ë¥¼ ìœ„ìƒì ìœ¼ë¡œ ìœ ì§€</div>
                    <div class="process-step"><span class="step-num">4</span> <strong>ì €ì•• ì„¸ì²™</strong> - ê¸°ì¡´ ìˆ˜ì••(6~10bar)ë³´ë‹¤ ë‚®ì€ 4barì˜ ì•ˆì „í•œ ì••ë ¥ìœ¼ë¡œ ë°°ê´€ ì†ìƒ ì—†ì´ ì˜¤ì—¼ë¬¼ ì œê±°</div>
                </div>
            </div>

            <div class="success-message" id="successMessage">âœ… ì˜ˆì•½ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

            <div class="form-group">
                <label>ì´ë¦„ <span class="required">*</span></label>
                <input type="text" id="name" placeholder="í™ê¸¸ë™">
            </div>

            <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="tel" id="phone" placeholder="010-1234-5678" maxlength="13">
            </div>

            <div class="form-group">
                <label>ì§‘ì£¼ì†Œ (ë™ í˜¸ìˆ˜ê¹Œì§€ ê¸°ì…) <span class="required">*</span></label>
                <textarea id="address" rows="3" placeholder="ì˜ˆ: ì¶©ë‚¨ì•„íŒŒíŠ¸ 621ë™ 1302í˜¸"></textarea>
            </div>

            <div class="form-group">
                <label style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">ì„œë¹„ìŠ¤ í¬ë§ ë‚ ì§œ <span class="required">*</span></label>
                <div class="date-selector" id="dateSelector">
                    <div class="date-selector-text date-selector-placeholder" id="dateDisplay">ğŸ“… ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                </div>
            </div>

            <div class="form-group" id="timeOptionsContainer">
                <label style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ ì„ íƒ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥) <span class="required">*</span></label>
                <div class="service-options" id="timeOptions">
                    <div class="service-card" data-value="ì˜¤ì „ 9ì‹œ - 12ì‹œ">
                        <div class="service-content"><span class="service-name">ì˜¤ì „ 9ì‹œ - 12ì‹œ</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ì˜¤í›„ 1ì‹œ - 4ì‹œ">
                        <div class="service-content"><span class="service-name">ì˜¤í›„ 1ì‹œ - 4ì‹œ</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ì˜¤í›„ 4ì‹œ - 7ì‹œ">
                        <div class="service-content"><span class="service-name">ì˜¤í›„ 4ì‹œ - 7ì‹œ</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)">
                        <div class="service-content"><span class="service-name">â­ ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)</span></div>
                        <span class="checkmark"></span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ì•„íŒŒíŠ¸ í‰ìˆ˜ <span class="required">*</span></label>
                <div class="service-options" id="sizeOptions">
                    <div class="service-card" data-value="30í‰í˜•(20í‰í˜• í¬í•¨)">
                        <div class="service-content"><span class="service-name">30í‰í˜• (20í‰í˜• í¬í•¨)</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="40í‰í˜•">
                        <div class="service-content"><span class="service-name">40í‰í˜•</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="50í‰í˜•">
                        <div class="service-content"><span class="service-name">50í‰í˜•</span></div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="60í‰í˜•">
                        <div class="service-content"><span class="service-name">60í‰í˜•</span></div>
                        <span class="checkmark"></span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ì„œë¹„ìŠ¤ ì¢…ë¥˜ <span class="required">*</span></label>
                <div class="service-options" id="serviceOptions">
                    <p style="color: #888; font-size: 14px; margin-bottom: 10px;">ë¨¼ì € ì•„íŒŒíŠ¸ í‰ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                </div>
            </div>

            <div class="form-group">
                <label style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">ê²°ì œ ë°©ë²• <span class="required">*</span></label>
                <div class="service-options" id="paymentOptions">
                    <div class="service-card" data-value="í˜„ê¸ˆì˜ìˆ˜ì¦" data-vat="true">
                        <div class="service-content">
                            <span class="service-name">ğŸ’µ í˜„ê¸ˆì˜ìˆ˜ì¦</span>
                            <span style="font-size: 12px; color: #e74c3c; font-weight: 600;">+10% ë¶€ê°€ì„¸</span>
                        </div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ì¹´ë“œ" data-vat="true">
                        <div class="service-content">
                            <span class="service-name">ğŸ’³ ì¹´ë“œ</span>
                            <span style="font-size: 12px; color: #e74c3c; font-weight: 600;">+10% ë¶€ê°€ì„¸</span>
                        </div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ê³„ì¢Œì´ì²´" data-vat="false">
                        <div class="service-content">
                            <span class="service-name">ğŸ¦ ê³„ì¢Œì´ì²´</span>
                            <span style="font-size: 12px; color: #27ae60; font-weight: 600;">ë¶€ê°€ì„¸ ì—†ìŒ</span>
                        </div>
                        <span class="checkmark"></span>
                    </div>
                    <div class="service-card" data-value="ë²•ì¸" data-vat="true">
                        <div class="service-content">
                            <span class="service-name">ğŸ¢ ë²•ì¸ (ì„¸ê¸ˆê³„ì‚°ì„œ)</span>
                            <span style="font-size: 12px; color: #e74c3c; font-weight: 600;">+10% ë¶€ê°€ì„¸</span>
                        </div>
                        <span class="checkmark"></span>
                    </div>
                </div>
            </div>

            <div class="price-summary" id="priceSummary" style="display: none;">
                <div class="price-row">
                    <span class="price-label">ì„œë¹„ìŠ¤ ê¸ˆì•¡</span>
                    <span class="price-value" id="basePrice">0ì›</span>
                </div>
                <div class="price-row" id="vatRow" style="display: none;">
                    <span class="price-label">ë¶€ê°€ì„¸ (10%)</span>
                    <span class="price-value" id="vatPrice">0ì›</span>
                </div>
                <div class="price-row">
                    <span class="price-label">ì´ ê²°ì œì˜ˆì •ê¸ˆì•¡</span>
                    <span class="price-value" id="totalPrice">0ì›</span>
                </div>
            </div>

            <button class="submit-btn" id="submitBtn" type="button">ì˜ˆì•½í•˜ê¸°</button>
        </div>
    </div>

    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-title">ğŸ“‹ ì…ë ¥í•˜ì‹  ì •ë³´ê°€ ë§ë‚˜ìš”?</div>
            <div class="confirm-info" id="confirmInfo"></div>
            <div class="confirm-buttons">
                <button class="btn-no" onclick="closeConfirmModal()">ì•„ë‹ˆì˜¤</button>
                <button class="btn-yes" onclick="confirmBooking()">ì˜ˆ, ì ‘ìˆ˜í•©ë‹ˆë‹¤</button>
            </div>
        </div>
    </div>

    <div class="calendar-modal" id="calendarModal">
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prevMonth">â—€</button>
                <div class="calendar-title" id="calendarTitle">2024ë…„ 1ì›”</div>
                <button class="calendar-nav-btn" id="nextMonth">â–¶</button>
            </div>
            <div class="calendar-weekdays">
                <div class="calendar-weekday" style="color: #e74c3c;">ì¼</div>
                <div class="calendar-weekday">ì›”</div>
                <div class="calendar-weekday">í™”</div>
                <div class="calendar-weekday">ìˆ˜</div>
                <div class="calendar-weekday">ëª©</div>
                <div class="calendar-weekday">ê¸ˆ</div>
                <div class="calendar-weekday" style="color: #3498db;">í† </div>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
            <button class="calendar-close" id="closeCalendar">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">ì˜ˆì•½ ì ‘ìˆ˜ ì¤‘...</div>
    </div>

    <script>
        var GOOGLE_SCRIPT_URL = '';
        var SHEET_ID = '18GV3tMuJKgOEfTZllnm93pMRbutlaYKnxHgp3rNpC-Y';

        var selectedSize = '';
        var selectedService = '';
        var selectedDate = null;
        var selectedTimes = [];
        var selectedPayment = '';
        var selectedPaymentVat = false;
        var currentYear = new Date().getFullYear();
        var currentMonth = new Date().getMonth();
        var tempBookingData = null;
        var managerSchedules = {};
        var dateAvailability = {};

        var priceTable = {
            '30í‰í˜•(20í‰í˜• í¬í•¨)': { water: 150000, heating: 210000, both: 280000 },
            '40í‰í˜•': { water: 180000, heating: 250000, both: 320000 },
            '50í‰í˜•': { water: 210000, heating: 290000, both: 360000 },
            '60í‰í˜•': { water: 250000, heating: 330000, both: 400000 }
        };

        function formatPrice(price) {
            return price.toLocaleString() + 'ì›';
        }

        function loadManagerSchedules() {
            var managers = JSON.parse(localStorage.getItem('managers') || '[]');
            managerSchedules = {};
            
            managers.forEach(function(manager) {
                var vacationKey = 'vacations_' + manager;
                var vacations = JSON.parse(localStorage.getItem(vacationKey) || '[]');
                managerSchedules[manager] = { vacations: vacations, bookings: [] };
            });

            for (var key in localStorage) {
                if (key.startsWith('booking:')) {
                    var booking = JSON.parse(localStorage.getItem(key));
                    if (booking.manager && booking.manager !== 'ë¯¸ë°°ì •' && managerSchedules[booking.manager]) {
                        managerSchedules[booking.manager].bookings.push({
                            date: booking.serviceDate,
                            timeSlots: booking.timeSlots || []
                        });
                    }
                }
            }
            updateDateAvailability();
        }

        function updateDateAvailability() {
            dateAvailability = {};
            var managers = Object.keys(managerSchedules);
            if (managers.length === 0) return;

            var today = new Date();
            for (var i = 0; i < 60; i++) {
                var checkDate = new Date(today);
                checkDate.setDate(today.getDate() + i);
                var dateStr = checkDate.getFullYear() + '-' + String(checkDate.getMonth() + 1).padStart(2, '0') + '-' + String(checkDate.getDate()).padStart(2, '0');

                var availableSlots = { 'ì˜¤ì „ 9ì‹œ - 12ì‹œ': 0, 'ì˜¤í›„ 1ì‹œ - 4ì‹œ': 0, 'ì˜¤í›„ 4ì‹œ - 7ì‹œ': 0, 'ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)': 0 };

                managers.forEach(function(manager) {
                    var schedule = managerSchedules[manager];
                    var isVacation = schedule.vacations.some(function(v) { return v.date === dateStr; });
                    if (isVacation) return;

                    var bookedSlots = [];
                    schedule.bookings.forEach(function(b) {
                        if (b.date === dateStr) bookedSlots = bookedSlots.concat(b.timeSlots);
                    });

                    if (!bookedSlots.includes('ì˜¤ì „ 9ì‹œ - 12ì‹œ') && !bookedSlots.includes('ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)')) availableSlots['ì˜¤ì „ 9ì‹œ - 12ì‹œ']++;
                    if (!bookedSlots.includes('ì˜¤í›„ 1ì‹œ - 4ì‹œ') && !bookedSlots.includes('ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)')) availableSlots['ì˜¤í›„ 1ì‹œ - 4ì‹œ']++;
                    if (!bookedSlots.includes('ì˜¤í›„ 4ì‹œ - 7ì‹œ') && !bookedSlots.includes('ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)')) availableSlots['ì˜¤í›„ 4ì‹œ - 7ì‹œ']++;
                    if (bookedSlots.length === 0) availableSlots['ì¢…ì¼ ê°€ëŠ¥ (9ì‹œ-7ì‹œ)']++;
                });

                dateAvailability[dateStr] = availableSlots;
            }
        }

        function updateTimeOptions() {
            if (!selectedDate) return;
            var dateStr = selectedDate.getFullYear() + '-' + String(selectedDate.getMonth() + 1).padStart(2, '0') + '-' + String(selectedDate.getDate()).padStart(2, '0');
            var availability = dateAvailability[dateStr];
            var timeCards = document.querySelectorAll('#timeOptions .service-card');

            timeCards.forEach(function(card) {
                var timeValue = card.getAttribute('data-value');
                card.classList.remove('disabled', 'selected');
                if (availability && availability[timeValue] === 0) card.classList.add('disabled');
            });
            selectedTimes = [];
        }

        document.getElementById('dateSelector').addEventListener('click', function() {
            document.getElementById('calendarModal').classList.add('show');
            renderCalendar();
        });

        document.getElementById('closeCalendar').addEventListener('click', function() {
            document.getElementById('calendarModal').classList.remove('show');
        });

        document.getElementById('prevMonth').addEventListener('click', function() {
            currentMonth--;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', function() {
            currentMonth++;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            renderCalendar();
        });

        function renderCalendar() {
            var monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('calendarTitle').textContent = currentYear + 'ë…„ ' + monthNames[currentMonth];

            var firstDay = new Date(currentYear, currentMonth, 1).getDay();
            var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            var today = new Date();
            var todayDate = today.getDate();
            var todayMonth = today.getMonth();
            var todayYear = today.getFullYear();

            var calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            for (var i = 0; i < firstDay; i++) {
                var emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarDays.appendChild(emptyDay);
            }

            for (var day = 1; day <= daysInMonth; day++) {
                var dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                var dayNumber = document.createElement('span');
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);

                var isToday = day === todayDate && currentMonth === todayMonth && currentYear === todayYear;
                var isPast = new Date(currentYear, currentMonth, day) < new Date(todayYear, todayMonth, todayDate);
                var dateStr = currentYear + '-' + String(currentMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                var availability = dateAvailability[dateStr];

                if (isToday) dayElement.classList.add('today');

                if (isPast) {
                    dayElement.classList.add('disabled');
                } else if (availability) {
                    var totalSlots = availability['ì˜¤ì „ 9ì‹œ - 12ì‹œ'] + availability['ì˜¤í›„ 1ì‹œ - 4ì‹œ'] + availability['ì˜¤í›„ 4ì‹œ - 7ì‹œ'];
                    
                    if (totalSlots === 0) {
                        dayElement.classList.add('full');
                        var indicator = document.createElement('div');
                        indicator.className = 'slots-indicator';
                        indicator.textContent = 'ë§ˆê°';
                        dayElement.appendChild(indicator);
                    } else {
                        (function(d) {
                            dayElement.addEventListener('click', function() {
                                selectedDate = new Date(currentYear, currentMonth, d);
                                var year = selectedDate.getFullYear();
                                var month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                                var dayStr = String(selectedDate.getDate()).padStart(2, '0');
                                document.getElementById('dateDisplay').textContent = year + 'ë…„ ' + parseInt(month) + 'ì›” ' + parseInt(dayStr) + 'ì¼';
                                document.getElementById('dateDisplay').classList.remove('date-selector-placeholder');
                                document.getElementById('calendarModal').classList.remove('show');
                                updateTimeOptions();
                            });
                        })(day);

                        if (selectedDate && day === selectedDate.getDate() && currentMonth === selectedDate.getMonth() && currentYear === selectedDate.getFullYear()) {
                            dayElement.classList.add('selected');
                        }
                    }
                } else {
                    (function(d) {
                        dayElement.addEventListener('click', function() {
                            selectedDate = new Date(currentYear, currentMonth, d);
                            var year = selectedDate.getFullYear();
                            var month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                            var dayStr = String(selectedDate.getDate()).padStart(2, '0');
                            document.getElementById('dateDisplay').textContent = year + 'ë…„ ' + parseInt(month) + 'ì›” ' + parseInt(dayStr) + 'ì¼';
                            document.getElementById('dateDisplay').classList.remove('date-selector-placeholder');
                            document.getElementById('calendarModal').classList.remove('show');
                            updateTimeOptions();
                        });
                    })(day);

                    if (selectedDate && day === selectedDate.getDate() && currentMonth === selectedDate.getMonth() && currentYear === selectedDate.getFullYear()) {
                        dayElement.classList.add('selected');
                    }
                }
                calendarDays.appendChild(dayElement);
            }
        }

        document.getElementById('phone').addEventListener('input', function(e) {
            var value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 3 && value.length <= 7) value = value.slice(0, 3) + '-' + value.slice(3);
            else if (value.length > 7) value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
            e.target.value = value;
        });

        var timeCards = document.querySelectorAll('#timeOptions .service-card');
        for (var i = 0; i < timeCards.length; i++) {
            timeCards[i].addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                var value = this.getAttribute('data-value');
                var index = selectedTimes.indexOf(value);
                if (index > -1) { selectedTimes.splice(index, 1); this.classList.remove('selected'); }
                else { selectedTimes.push(value); this.classList.add('selected'); }
            });
        }

        var sizeCards = document.querySelectorAll('#sizeOptions .service-card');
        for (var i = 0; i < sizeCards.length; i++) {
            sizeCards[i].addEventListener('click', function() {
                var cards = document.querySelectorAll('#sizeOptions .service-card');
                for (var j = 0; j < cards.length; j++) cards[j].classList.remove('selected');
                this.classList.add('selected');
                selectedSize = this.getAttribute('data-value');
                selectedService = '';
                updateServiceOptions(selectedSize);
                updatePriceSummary();
            });
        }

        var paymentCards = document.querySelectorAll('#paymentOptions .service-card');
        for (var i = 0; i < paymentCards.length; i++) {
            paymentCards[i].addEventListener('click', function() {
                var cards = document.querySelectorAll('#paymentOptions .service-card');
                for (var j = 0; j < cards.length; j++) cards[j].classList.remove('selected');
                this.classList.add('selected');
                selectedPayment = this.getAttribute('data-value');
                selectedPaymentVat = this.getAttribute('data-vat') === 'true';
                updatePriceSummary();
            });
        }

        function updateServiceOptions(size) {
            var serviceContainer = document.getElementById('serviceOptions');
            var prices = priceTable[size];
            if (!prices) { serviceContainer.innerHTML = '<p style="color: #888; font-size: 14px;">í‰ìˆ˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”</p>'; return; }

            var html = '';
            html += '<div class="service-card" data-value="ìˆ˜ë„+ë‚œë°© ë°°ê´€ ìŠ¤ì¼€ì¼ë§ (' + formatPrice(prices.both) + ')" data-price="' + prices.both + '"><div class="service-content"><span class="service-name">ìˆ˜ë„+ë‚œë°© ë°°ê´€ ìŠ¤ì¼€ì¼ë§</span><span style="font-size: 18px; font-weight: 700; color: #00AEEF;">' + formatPrice(prices.both) + '</span></div><span class="checkmark"></span></div>';
            html += '<div class="service-card" data-value="ë‚œë°©ë°°ê´€ ìŠ¤ì¼€ì¼ë§ (' + formatPrice(prices.heating) + ')" data-price="' + prices.heating + '"><div class="service-content"><span class="service-name">ë‚œë°©ë°°ê´€ ìŠ¤ì¼€ì¼ë§</span><span style="font-size: 18px; font-weight: 700; color: #00AEEF;">' + formatPrice(prices.heating) + '</span></div><span class="checkmark"></span></div>';
            html += '<div class="service-card" data-value="ìˆ˜ë„ë°°ê´€ ìŠ¤ì¼€ì¼ë§ (' + formatPrice(prices.water) + ')" data-price="' + prices.water + '"><div class="service-content"><span class="service-name">ìˆ˜ë„ë°°ê´€ ìŠ¤ì¼€ì¼ë§</span><span style="font-size: 18px; font-weight: 700; color: #00AEEF;">' + formatPrice(prices.water) + '</span></div><span class="checkmark"></span></div>';
            
            serviceContainer.innerHTML = html;
            
            var serviceCards = document.querySelectorAll('#serviceOptions .service-card');
            for (var i = 0; i < serviceCards.length; i++) {
                serviceCards[i].addEventListener('click', function() {
                    var cards = document.querySelectorAll('#serviceOptions .service-card');
                    for (var j = 0; j < cards.length; j++) cards[j].classList.remove('selected');
                    this.classList.add('selected');
                    selectedService = this.getAttribute('data-value');
                    updatePriceSummary();
                });
            }
        }

        function updatePriceSummary() {
            var priceSummary = document.getElementById('priceSummary');
            if (!selectedService || !selectedPayment) { priceSummary.style.display = 'none'; return; }

            var priceMatch = selectedService.match(/\(([0-9,]+)ì›\)/);
            if (!priceMatch) { priceSummary.style.display = 'none'; return; }

            var basePrice = parseInt(priceMatch[1].replace(/,/g, ''));
            var vatAmount = selectedPaymentVat ? Math.round(basePrice * 0.1) : 0;
            var totalAmount = basePrice + vatAmount;

            document.getElementById('basePrice').textContent = formatPrice(basePrice);
            if (selectedPaymentVat) { document.getElementById('vatRow').style.display = 'flex'; document.getElementById('vatPrice').textContent = formatPrice(vatAmount); }
            else { document.getElementById('vatRow').style.display = 'none'; }
            document.getElementById('totalPrice').textContent = formatPrice(totalAmount);
            priceSummary.style.display = 'block';
        }

        document.getElementById('submitBtn').onclick = function() {
            var name = document.getElementById('name').value.trim();
            var phone = document.getElementById('phone').value.trim();
            var address = document.getElementById('address').value.trim();

            if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); document.getElementById('name').focus(); return; }
            if (!phone) { alert('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); document.getElementById('phone').focus(); return; }
            if (!address) { alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!'); document.getElementById('address').focus(); return; }
            if (!selectedDate) { alert('ì„œë¹„ìŠ¤ í¬ë§ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            if (selectedTimes.length === 0) { alert('ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            if (!selectedSize) { alert('ì•„íŒŒíŠ¸ í‰ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            if (!selectedService) { alert('ì„œë¹„ìŠ¤ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
            if (!selectedPayment) { alert('ê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }

            var now = new Date();
            var year = now.getFullYear();
            var month = String(now.getMonth() + 1).padStart(2, '0');
            var day = String(now.getDate()).padStart(2, '0');
            var hour = String(now.getHours()).padStart(2, '0');
            var minute = String(now.getMinutes()).padStart(2, '0');

            var serviceYear = selectedDate.getFullYear();
            var serviceMonth = String(selectedDate.getMonth() + 1).padStart(2, '0');
            var serviceDay = String(selectedDate.getDate()).padStart(2, '0');
            var serviceDateString = serviceYear + '-' + serviceMonth + '-' + serviceDay;

            var priceMatch = selectedService.match(/\(([0-9,]+)ì›\)/);
            var basePrice = priceMatch ? parseInt(priceMatch[1].replace(/,/g, '')) : 0;
            var vatAmount = selectedPaymentVat ? Math.round(basePrice * 0.1) : 0;
            var totalAmount = basePrice + vatAmount;

            tempBookingData = {
                id: now.getTime(),
                date: year + '-' + month + '-' + day,
                receivedDate: year + '-' + month + '-' + day,
                timestamp: year + '-' + month + '-' + day + ' ' + hour + ':' + minute,
                serviceDate: serviceDateString,
                timeSlots: selectedTimes,
                name: name,
                phone: phone,
                address: address,
                size: selectedSize,
                service: selectedService,
                status: 'received',
                manager: 'ë¯¸ë°°ì •',
                assignmentSent: false,
                assignmentAccepted: false,
                revenue: totalAmount,
                basePrice: basePrice,
                vatAmount: vatAmount,
                managerPay: 0,
                unpaid: totalAmount,
                paymentMethod: selectedPayment,
                depositDate: '',
                category: selectedPayment === 'ë²•ì¸' ? 'ë²•ì¸' : 'ê°œì¸'
            };

            var confirmInfo = document.getElementById('confirmInfo');
            confirmInfo.innerHTML = 
                '<div class="confirm-row"><div class="confirm-label">ì´ë¦„</div><div class="confirm-value">' + tempBookingData.name + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">ì „í™”ë²ˆí˜¸</div><div class="confirm-value">' + tempBookingData.phone + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">ì£¼ì†Œ</div><div class="confirm-value">' + tempBookingData.address + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">ì„œë¹„ìŠ¤ ë‚ ì§œ</div><div class="confirm-value">' + tempBookingData.serviceDate + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">í¬ë§ ì‹œê°„</div><div class="confirm-value">' + tempBookingData.timeSlots.join(', ') + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">í‰í˜•</div><div class="confirm-value">' + tempBookingData.size + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">ì„œë¹„ìŠ¤</div><div class="confirm-value">' + tempBookingData.service + '</div></div>' +
                '<div class="confirm-row"><div class="confirm-label">ê²°ì œë°©ë²•</div><div class="confirm-value">' + tempBookingData.paymentMethod + '</div></div>' +
                '<div class="confirm-row" style="background: #d4edda; margin: -20px; margin-top: 15px; padding: 20px; border-radius: 0 0 12px 12px;"><div class="confirm-label" style="color: #155724; font-size: 18px;">ì´ ê²°ì œê¸ˆì•¡</div><div class="confirm-value" style="color: #155724; font-size: 20px; font-weight: 900;">' + formatPrice(totalAmount) + (selectedPaymentVat ? ' (VAT í¬í•¨)' : '') + '</div></div>';

            document.getElementById('confirmModal').classList.add('show');
        };

        function confirmBooking() {
            if (!tempBookingData) { alert('ì˜ˆì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤!'); return; }
            document.getElementById('loadingOverlay').classList.add('show');
            localStorage.setItem('booking:' + tempBookingData.id, JSON.stringify(tempBookingData));
            saveToGoogleSheets(tempBookingData);

            setTimeout(function() {
                document.getElementById('loadingOverlay').classList.remove('show');
                document.getElementById('confirmModal').classList.remove('show');
                document.getElementById('successMessage').classList.add('show');

                document.getElementById('name').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('address').value = '';
                selectedDate = null;
                document.getElementById('dateDisplay').textContent = 'ğŸ“… ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                document.getElementById('dateDisplay').classList.add('date-selector-placeholder');
                
                var allCards = document.querySelectorAll('.service-card');
                for (var i = 0; i < allCards.length; i++) allCards[i].classList.remove('selected');
                selectedSize = '';
                selectedService = '';
                selectedTimes = [];
                selectedPayment = '';
                selectedPaymentVat = false;
                document.getElementById('serviceOptions').innerHTML = '<p style="color: #888; font-size: 14px; margin-bottom: 10px;">ë¨¼ì € ì•„íŒŒíŠ¸ í‰ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>';
                document.getElementById('priceSummary').style.display = 'none';

                window.scrollTo({ top: 0, behavior: 'smooth' });
                setTimeout(function() { document.getElementById('successMessage').classList.remove('show'); }, 5000);
                alert('âœ… ì˜ˆì•½ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!\në¹ ë¥¸ ì‹œì¼ ë‚´ì— ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.');
                tempBookingData = null;
                loadManagerSchedules();
            }, 1500);
        }

        function saveToGoogleSheets(data) {
            console.log('ğŸ“¤ Google Sheets ì €ì¥ ì‹œë„:', data);
            
            // âš ï¸ ë°°í¬ í›„ ì•„ë˜ URLì„ ì‹¤ì œ ì›¹ ì•± URLë¡œ êµì²´í•˜ì„¸ìš”!
            // ì˜ˆ: 'https://script.google.com/macros/s/XXXX/exec'
            if (!GOOGLE_SCRIPT_URL) {
                console.log('âš ï¸ GOOGLE_SCRIPT_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. êµ¬ê¸€ì‹œíŠ¸ ì—°ë™ì„ ìœ„í•´ Apps Script ë°°í¬ í›„ URLì„ ì„¤ì •í•˜ì„¸ìš”.');
                return;
            }
            
            var payload = {
                action: 'newBooking',
                bookingId: data.id,
                name: data.name,
                phone: data.phone,
                address: data.address,
                size: data.size,
                service: data.service,
                serviceDate: data.serviceDate,
                timeSlots: data.timeSlots ? data.timeSlots.join(', ') : 'ë¯¸ì •',
                paymentMethod: data.paymentMethod,
                basePrice: data.basePrice,
                vatAmount: data.vatAmount,
                totalPrice: data.totalPrice,
                customerType: data.paymentMethod === 'ë²•ì¸(ì„¸ê¸ˆê³„ì‚°ì„œ)' ? 'ë²•ì¸' : 'ê°œì¸'
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(function() {
                console.log('âœ… Google Sheets ì „ì†¡ ì™„ë£Œ');
            })
            .catch(function(error) {
                console.error('âŒ Google Sheets ì „ì†¡ ì‹¤íŒ¨:', error);
            });
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
            tempBookingData = null;
        }

        window.addEventListener('load', function() {
            console.log('âœ… ì˜ˆì•½ í˜ì´ì§€ ë¡œë“œ');
            loadManagerSchedules();
        });
    </script>
</body>
</html>
